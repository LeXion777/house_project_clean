<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>LLaMA3 Chat Playground</title>

    <!-- âœ… ë„¤ë¹„ê²Œì´ì…˜ ë°”ê°€ Bootstrap ê¸°ë°˜ì´ë¯€ë¡œ llama.htmlì—ì„œë§Œ Bootstrap ë¡œë“œ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        :root {
          /* âœ… ë°ì€ í…Œë§ˆë¡œ ì¡°ì • (ë„¤ë¹„ê²Œì´ì…˜ë°”ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€) */
          --bg: #f6f8fc;                 /* í˜ì´ì§€ ë°°ê²½ */
          --panel: #ffffff;              /* ì¹´ë“œ/íŒ¨ë„ */
          --panel-soft: #f3f6fb;         /* ë¶€ë“œëŸ¬ìš´ íŒ¨ë„(ì±„íŒ… ì˜ì—­ ë°°ê²½ ë“±) */
          --border: #d8e2f0;             /* ê²½ê³„ì„  */
          --shadow: 0 10px 25px rgba(15, 23, 42, 0.08);

          /* âœ… ì‹œê·¸ë‹ˆì²˜/í¬ì¸íŠ¸(ë¡œê³  ì£¼í™© í™œìš©) */
          --brand: #ff6b00;
          --primary: #1b64da;            /* ë²„íŠ¼/ì‚¬ìš©ì ë§í’ì„  */
          --primary-soft: rgba(27,100,218,0.10);

          /* í…ìŠ¤íŠ¸ */
          --text: #0f172a;
          --muted: #64748b;

          /* ë§í’ì„  */
          --assistant: #eef2f7;          /* ì–´ì‹œìŠ¤í„´íŠ¸ ë§í’ì„ (ë°ê²Œ) */
          --assistant-border: #dde6f3;

          --nav-h: 70px;                 /* âœ… ë„¤ë¹„ ë†’ì´(ìš”êµ¬ì‚¬í•­) */
        }

        * { box-sizing: border-box; font-family: Pretendard, sans-serif; }

        html, body {
          margin: 0;
          padding: 0;
          height: 100%;
        }

        body {
          background: var(--bg);
          color: var(--text);
          overflow: hidden; /* âœ… í˜ì´ì§€ ìŠ¤í¬ë¡¤ ì œê±° */
        }

        /* âœ… ë„¤ë¹„+ì•± ì „ì²´ë¥¼ í•œ í™”ë©´ì— ê³ ì •: ë„¤ë¹„(70px) + ì•±(ë‚˜ë¨¸ì§€) */
        .page-wrapper {
          height: 100vh;
          display: flex;
          flex-direction: column;
          overflow: hidden;
        }

        /* âœ… ê¸°ì¡´ llama ì•± ë†’ì´ë¥¼ ë„¤ë¹„ë§Œí¼ ì¤„ì—¬ì„œ ìŠ¤í¬ë¡¤ ì—†ì´ í•œ í™”ë©´ */
        .app {
          height: calc(100vh - var(--nav-h));
          display: grid;
          grid-template-columns: 1fr 380px;
          overflow: hidden;
        }

        /* ===== LEFT ===== */
        .main {
          display: flex;
          flex-direction: column;
          height: 100%;
          min-height: 0;
          background: var(--panel-soft);
        }

        header {
          padding: 12px 20px;
          background: linear-gradient(180deg, #ffffff 0%, #f7faff 100%);
          border-bottom: 1px solid var(--border);
          font-weight: 800;

          /* âœ… í—¤ë”ì— ì•ˆì „í•˜ê²Œ ë²„íŠ¼ ë°°ì¹˜(ìš°ì¸¡) */
          display: flex;
          align-items: center;
          justify-content: space-between;
          gap: 12px;
          min-height: 52px;

          box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
        }

        .header-title {
          display: flex;
          align-items: center;
          gap: 8px;
          min-width: 0;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          color: var(--text);
        }

        /* âœ… ëŒ€í™” ì´ˆê¸°í™” ë²„íŠ¼(ìœ„í—˜ ì¤„ì´ê¸°: ì‘ê²Œ + í—¤ë” ìš°ì¸¡ + ê²½ê³ í†¤) */
        .reset-chat-btn {
          padding: 8px 12px;
          border-radius: 10px;
          border: 1px solid rgba(239,68,68,0.45);
          background: rgba(239,68,68,0.08);
          color: #b91c1c;
          cursor: pointer;
          font-weight: 800;
          font-size: 13px;
          white-space: nowrap;
          line-height: 1;
          box-shadow: 0 6px 14px rgba(239, 68, 68, 0.10);
        }
        .reset-chat-btn:hover {
          background: rgba(239,68,68,0.12);
          border-color: rgba(239,68,68,0.60);
        }
        .reset-chat-btn:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .chat-wrapper {
          flex: 1;
          min-height: 0;
          overflow-y: auto;
          padding: 22px;
          background:
            radial-gradient(1200px 600px at 20% 0%, rgba(255,107,0,0.07), transparent 60%),
            radial-gradient(900px 500px at 90% 20%, rgba(27,100,218,0.08), transparent 55%),
            var(--panel-soft);
        }

        .chat {
          max-width: 900px;
          margin: 0 auto;
        }

        .msg {
          max-width: 75%;
          padding: 12px 16px;
          border-radius: 14px;
          margin-bottom: 14px;
          line-height: 1.6;
          white-space: pre-wrap;
          word-break: break-word;
          box-shadow: 0 10px 22px rgba(15,23,42,0.06);
        }

        .msg.user {
          background: linear-gradient(180deg, rgba(27,100,218,0.92), rgba(27,100,218,0.82));
          color: #ffffff;
          margin-left: auto;
          border: 1px solid rgba(27,100,218,0.20);
        }

        .msg.assistant {
          background: var(--assistant);
          color: var(--text);
          margin-right: auto;
          border: 1px solid var(--assistant-border);
        }

        .msg.typing {
          background: var(--assistant);
          color: var(--muted);
          font-style: italic;
          border: 1px solid var(--assistant-border);
        }

        .msg.typing::after {
          content: "...";
          animation: dots 1.2s infinite;
        }

        @keyframes dots {
          0% { content: "."; }
          33% { content: ".."; }
          66% { content: "..."; }
        }

        /* Input */
        .input-bar {
          border-top: 1px solid var(--border);
          background: #ffffff;
          padding: 14px 20px;
          box-shadow: 0 -10px 22px rgba(15,23,42,0.06);
        }

        .input-inner {
          max-width: 900px;
          margin: 0 auto;
          display: flex;
          gap: 10px;
        }

        textarea#prompt {
          flex: 1;
          resize: none;
          padding: 12px 12px;
          border-radius: 12px;
          background: #ffffff;
          border: 1px solid var(--border);
          color: var(--text);
          outline: none;
          box-shadow: 0 8px 18px rgba(15,23,42,0.06);
        }
        textarea#prompt:focus {
          border-color: rgba(27,100,218,0.45);
          box-shadow:
            0 10px 24px rgba(27,100,218,0.12),
            0 0 0 4px rgba(27,100,218,0.10);
        }

        button {
          padding: 0 20px;
          border-radius: 12px;
          border: 1px solid rgba(27,100,218,0.18);
          background: linear-gradient(180deg, rgba(27,100,218,0.95), rgba(27,100,218,0.85));
          color: white;
          cursor: pointer;
          font-weight: 800;
          box-shadow: 0 10px 22px rgba(27,100,218,0.14);
        }
        button:hover {
          filter: brightness(1.02);
        }

        button:disabled {
          opacity: 0.5;
          cursor: not-allowed;
          box-shadow: none;
        }

        /* ===== RIGHT SETTINGS ===== */
        .settings {
          background: #ffffff;
          border-left: 1px solid var(--border);
          padding: 20px;
          overflow-y: auto;
          box-shadow: -10px 0 22px rgba(15,23,42,0.06);
        }

        .settings h3 {
          margin-top: 0;
          margin-bottom: 10px;
          font-weight: 900;
          color: var(--text);
        }

        .settings textarea[name="system_prompt"]{
          background: #ffffff !important;
          color: var(--text) !important;
          border: 1px solid var(--border) !important;
          border-radius: 12px !important;
          padding: 10px 12px !important;
          outline: none !important;
          box-shadow: 0 8px 18px rgba(15,23,42,0.06);
        }
        .settings textarea[name="system_prompt"]:focus{
          border-color: rgba(255,107,0,0.55) !important;
          box-shadow:
            0 10px 24px rgba(255,107,0,0.14),
            0 0 0 4px rgba(255,107,0,0.10) !important;
        }

        .param { margin-bottom: 16px; }

        .param label {
          font-size: 13px;
          color: var(--muted);
          display: block;
          margin-bottom: 6px;
          font-weight: 700;
        }

        .param-row {
          display: flex;
          gap: 10px;
          align-items: center;
        }

        .param-row input[type=range] { flex: 1; }

        .param-row input[type=number] {
          width: 76px;
          background: #ffffff;
          border: 1px solid var(--border);
          color: var(--text);
          border-radius: 10px;
          padding: 6px 8px;
          outline: none;
          box-shadow: 0 8px 18px rgba(15,23,42,0.06);
        }
        .param-row input[type=number]:focus {
          border-color: rgba(27,100,218,0.45);
          box-shadow:
            0 10px 24px rgba(27,100,218,0.12),
            0 0 0 4px rgba(27,100,218,0.10);
        }

        /* ë²„íŠ¼ 2ê°œ(Reset/Apply) ëŠë‚Œ ì •ë¦¬ */
        #resetParams{
          border: 1px solid var(--border) !important;
          background: linear-gradient(180deg, #ffffff 0%, #f2f6fc 100%) !important;
          color: var(--text) !important;
          font-weight: 900 !important;
          box-shadow: 0 10px 22px rgba(15,23,42,0.08) !important;
        }
        #resetParams:hover{
          box-shadow: 0 12px 26px rgba(15,23,42,0.10) !important;
        }

        .apply {
          width: 100%;
          padding: 12px 10px;
          border-radius: 12px;
          border: 1px solid rgba(255,107,0,0.25);
          background: linear-gradient(180deg, rgba(255,107,0,0.95), rgba(255,107,0,0.85));
          color: #ffffff;
          cursor: pointer;
          margin-top: 12px;
          font-weight: 900;
          box-shadow: 0 12px 26px rgba(255,107,0,0.18);
        }
        .apply:hover {
          filter: brightness(1.02);
        }

        /* ===== OVERLAY (Apply/Reset ì¤‘ ì ê¸ˆ) ===== */
        .overlay {
          position: fixed;
          inset: 0;
          background: rgba(15,23,42,0.35);
          backdrop-filter: blur(2px);
          display: none;
          align-items: center;
          justify-content: center;
          z-index: 9999;
          pointer-events: all;
        }

        .overlay-box {
          background: #ffffff;
          padding: 22px 28px;
          border-radius: 14px;
          font-size: 16px;
          border: 1px solid var(--border);
          color: var(--text);
          box-shadow: var(--shadow);
          font-weight: 800;
        }

        /* ======================================
           âœ… ì „ì›”ì„¸ ì§€ë„ í˜ì´ì§€ ì „ìš© ë„¤ë¹„ê²Œì´ì…˜ë°” CSS (ê·¸ëŒ€ë¡œ) - ìˆ˜ì • ê¸ˆì§€
        ====================================== */
        .predict-navbar {
          background: linear-gradient(90deg, #0b1d33, #0f2a52);
          height: var(--nav-h);
          padding: 0 2rem !important;
          border-bottom: none;
        }

        .predict-navbar .nav-link {
          color: #fff !important;
          font-weight: 500;
          font-size: 1rem;
          transition: color 0.25s ease, transform 0.25s ease;
          display: inline-block;
        }

        .predict-navbar .nav-link:hover {
          color: #ff6b00 !important;
          transform: translateY(-2px);
        }

        .predict-navbar .navbar-brand img {
          height: 40px;
          filter: brightness(1.1);
        }

        .predict-navbar .navbar-toggler {
          border-color: rgba(255,255,255,0.5);
        }

        .predict-navbar .navbar-toggler-icon {
          filter: brightness(200%);
        }

        /* âœ… ìŠ¤í¬ë¡¤ë°”(ì„ íƒ): ë„ˆë¬´ íŠ€ì§€ ì•Šê²Œ ë°ì€ í…Œë§ˆìš© */
        .chat-wrapper::-webkit-scrollbar,
        .settings::-webkit-scrollbar {
          width: 10px;
        }
        .chat-wrapper::-webkit-scrollbar-thumb,
        .settings::-webkit-scrollbar-thumb {
          background: rgba(100,116,139,0.28);
          border-radius: 999px;
          border: 2px solid rgba(255,255,255,0.65);
        }
        .chat-wrapper::-webkit-scrollbar-track,
        .settings::-webkit-scrollbar-track {
          background: rgba(255,255,255,0.0);
        }
    </style>

    <script>
        /* =========================================================
           DEFAULT PRESET (ì´ˆê¸°ê°’)
        ========================================================= */
        const DEFAULT_PRESET = {
          temperature: 0.7,
          top_p: 0.9,
          top_k: 50,
          max_tokens: 512,
          repetition_penalty: 1.1
        };

        /* =========================================================
           Utility
        ========================================================= */
        function scrollToBottom(wrapper) {
          requestAnimationFrame(() => {
            wrapper.scrollTop = wrapper.scrollHeight;
          });
        }

        // range <-> number ë™ê¸°í™” (ì–‘ë°©í–¥ + clamp)
        function bindRangeNumber(rangeEl, numberEl) {
          if (!rangeEl || !numberEl) return;

          const min = Number(rangeEl.min);
          const max = Number(rangeEl.max);
          const step = Number(rangeEl.step || 1);

          const clampToStep = (val) => {
            if (Number.isNaN(val)) return Number(rangeEl.value);
            let v = Math.min(max, Math.max(min, val));
            const decimals = (String(step).split(".")[1] || "").length;
            const snapped = Math.round((v - min) / step) * step + min;
            return Number(snapped.toFixed(decimals));
          };

          const syncFromRange = () => {
            numberEl.value = rangeEl.value;
          };

          const syncFromNumber = () => {
            const v = clampToStep(Number(numberEl.value));
            rangeEl.value = String(v);
            numberEl.value = String(v);
          };

          rangeEl.addEventListener("input", syncFromRange);
          numberEl.addEventListener("input", () => {
            const raw = Number(numberEl.value);
            if (Number.isNaN(raw)) return;
            rangeEl.value = Math.min(max, Math.max(min, raw));
          });
          numberEl.addEventListener("change", syncFromNumber);
          numberEl.addEventListener("blur", syncFromNumber);

          syncFromRange();
        }

        // overlay í‘œì‹œ/ìˆ¨ê¹€ + ì „ì²´ UI ì ê¸ˆ
        function setOverlay(show, text) {
          const overlay = document.getElementById("overlay");
          const box = document.getElementById("overlayText");

          if (text) box.textContent = text;
          overlay.style.display = show ? "flex" : "none";

          if (show) {
            document.body.dataset.prevOverflow = document.body.style.overflow || "";
            document.body.style.overflow = "hidden";
          } else {
            document.body.style.overflow = document.body.dataset.prevOverflow || "";
            delete document.body.dataset.prevOverflow;
          }
        }

        // íŒŒë¼ë¯¸í„° ê°’ ì„¸íŒ… (range + number ë™ì‹œì—)
        function setParam(id, value) {
          const range = document.getElementById(id);
          const num = document.getElementById(id + "_num");
          if (!range || !num) return;

          range.value = value;
          num.value = value;
          range.dispatchEvent(new Event("input"));
        }

        document.addEventListener("DOMContentLoaded", () => {
          /* =======================
             Elements
          ======================= */
          const textarea = document.getElementById("prompt");
          const sendBtn = document.getElementById("send");
          const resetChatBtn = document.getElementById("resetChat");
          const resetChatForm = document.getElementById("resetChatForm");

          const chat = document.querySelector(".chat");
          const wrapper = document.querySelector(".chat-wrapper");

          const temperature = document.getElementById("temperature");
          const temperature_num = document.getElementById("temperature_num");
          const top_p = document.getElementById("top_p");
          const top_p_num = document.getElementById("top_p_num");
          const top_k = document.getElementById("top_k");
          const top_k_num = document.getElementById("top_k_num");
          const max_tokens = document.getElementById("max_tokens");
          const max_tokens_num = document.getElementById("max_tokens_num");
          const repetition_penalty = document.getElementById("repetition_penalty");
          const repetition_penalty_num = document.getElementById("repetition_penalty_num");

          scrollToBottom(wrapper);

          /* =======================
             Send enable/disable
          ======================= */
          sendBtn.disabled = true;
          textarea.addEventListener("input", () => {
            sendBtn.disabled = textarea.value.trim() === "";
          });

          textarea.addEventListener("keydown", (e) => {
            if (e.key === "Enter" && !e.shiftKey) {
              e.preventDefault();
              if (!sendBtn.disabled) sendBtn.click();
            }
          });

          /* =======================
             Chat Send (JSON)
          ======================= */
          let isSending = false;
          let isResetting = false;

          sendBtn.addEventListener("click", async () => {
            if (isSending || isResetting) return;

            const text = textarea.value.trim();
            if (!text) return;

            isSending = true;

            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¦‰ì‹œ ì¶”ê°€
            const userMsg = document.createElement("div");
            userMsg.className = "msg user";
            userMsg.innerText = text;
            chat.appendChild(userMsg);

            // typing ì¶”ê°€
            const typing = document.createElement("div");
            typing.className = "msg assistant typing";
            typing.innerText = "";
            chat.appendChild(typing);

            scrollToBottom(wrapper);

            // ì…ë ¥ ì ê¸ˆ
            textarea.value = "";
            textarea.disabled = true;
            sendBtn.disabled = true;
            resetChatBtn.disabled = true;

            try {
              const res = await fetch("/llama", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ prompt: text })
              });

              if (!res.ok) throw new Error("HTTP " + res.status);

              const ct = res.headers.get("content-type") || "";
              if (!ct.includes("application/json")) {
                throw new Error("Invalid response type");
              }

              const data = await res.json();

              typing.remove();

              const botMsg = document.createElement("div");
              botMsg.className = "msg assistant";
              botMsg.innerText = (data && data.answer) ? data.answer : "(ë¹ˆ ì‘ë‹µ)";
              chat.appendChild(botMsg);

              scrollToBottom(wrapper);

            } catch (err) {
              typing.remove();

              const errMsg = document.createElement("div");
              errMsg.className = "msg assistant";
              errMsg.innerText = "âš ï¸ ì˜¤ë¥˜ ë°œìƒ\n" + err;
              chat.appendChild(errMsg);

              scrollToBottom(wrapper);
            } finally {
              textarea.disabled = false;
              textarea.focus();
              isSending = false;

              sendBtn.disabled = true;       // í…ìŠ¤íŠ¸ ë¹„ì–´ìˆìŒ
              resetChatBtn.disabled = false; // ë‹¤ì‹œ í™œì„±í™”
            }
          });

          /* =======================
             âœ… Chat Reset (FORM)
             - ì„œë²„ê°€ redirect/HTMLë¡œ ì‘ë‹µí•´ë„ ì‹¤íŒ¨í•˜ì§€ ì•Šê²Œ
             - confirm + overlay
          ======================= */
          resetChatBtn.addEventListener("click", () => {
            if (isSending || isResetting) return;

            const ok = confirm("ëŒ€í™” ë‚´ì—­ì„ ëª¨ë‘ ì´ˆê¸°í™”í• ê¹Œìš”?\n(ìƒˆë¡œê³ ì¹¨í•´ë„ ë³µêµ¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤)");
            if (!ok) return;

            isResetting = true;

            textarea.disabled = true;
            sendBtn.disabled = true;
            resetChatBtn.disabled = true;

            setOverlay(true, "ëŒ€í™” ì´ˆê¸°í™”ì¤‘ì…ë‹ˆë‹¤â€¦");

            // âœ… JSON fetch ëŒ€ì‹  FORM submit (ì„œë²„ redirect êµ¬ì¡°ì™€ 100% í˜¸í™˜)
            resetChatForm.submit();
          });

          /* =======================
             Hyper Parameter Sync
          ======================= */
          bindRangeNumber(temperature, temperature_num);
          bindRangeNumber(top_p, top_p_num);
          bindRangeNumber(top_k, top_k_num);
          bindRangeNumber(max_tokens, max_tokens_num);
          bindRangeNumber(repetition_penalty, repetition_penalty_num);

          /* =======================
             Reset Params Button
          ======================= */
          const resetParamsBtn = document.getElementById("resetParams");
          resetParamsBtn.addEventListener("click", () => {
            setParam("temperature", DEFAULT_PRESET.temperature);
            setParam("top_p", DEFAULT_PRESET.top_p);
            setParam("top_k", DEFAULT_PRESET.top_k);
            setParam("max_tokens", DEFAULT_PRESET.max_tokens);
            setParam("repetition_penalty", DEFAULT_PRESET.repetition_penalty);
          });

          /* =======================
             Apply Params Overlay
          ======================= */
          const paramForm = document.getElementById("paramForm");
          paramForm.addEventListener("submit", () => {
            setOverlay(true, "í•˜ì´í¼íŒŒë¼ë¯¸í„° ì ìš©ì¤‘ì…ë‹ˆë‹¤â€¦");
          });

          /* =======================
             overlay ìœ„ì—ì„œ ì´ë²¤íŠ¸ ë¨¹ê¸° (ì™„ì „ ì ê¸ˆ)
          ======================= */
          const overlay = document.getElementById("overlay");
          overlay.addEventListener("click", (e) => e.preventDefault());
          overlay.addEventListener("wheel", (e) => e.preventDefault(), { passive: false });
          document.addEventListener("keydown", (e) => {
            if (overlay.style.display === "flex") e.preventDefault();
          }, { capture: true });
        });
    </script>
</head>

<body>
<div class="overlay" id="overlay">
    <div class="overlay-box" id="overlayText">í•˜ì´í¼íŒŒë¼ë¯¸í„° ì ìš©ì¤‘ì…ë‹ˆë‹¤â€¦</div>
</div>

<div class="page-wrapper">

    <!-- âœ… NAVIGATION BAR (ê³µìš©) - ìˆ˜ì • ê¸ˆì§€ -->
    <nav class="navbar navbar-expand-lg predict-navbar">
        <div class="container-fluid px-4">

            <a class="navbar-brand" href="{{ url_for('index.index') }}">
                <img src="{{ url_for('static', filename='image/logo2.png') }}"
                     alt="ì²­ë…„ ì£¼ê±° ì†”ë£¨ì…˜ ë¡œê³ "
                     style="height:40px; width:auto;">
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#topNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="topNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item ms-3">
                        <a class="nav-link" href="{{ url_for('predict.predict_search') }}">ì „ì›”ì„¸ ì˜ˆì¸¡</a>
                    </li>
                    <li class="nav-item ms-3">
                        <a class="nav-link" href="{{ url_for('support.support_search') }}">ì •ë¶€ì§€ì›</a>
                    </li>
                    <li class="nav-item ms-3">
                        <a class="nav-link" href="{{ url_for('login.login') }}">ë¡œê·¸ì¸</a>
                    </li>
                    <li class="nav-item ms-3">
                        <a class="nav-link" href="{{ url_for('login.signup') }}">íšŒì›ê°€ì…</a>
                    </li>
                </ul>
            </div>

        </div>
    </nav>

    <!-- âœ… llama ì•± (ê¸°ëŠ¥/êµ¬ì¡° ê·¸ëŒ€ë¡œ) -->
    <div class="app">

        <!-- LEFT -->
        <div class="main">
            <header>
                <div class="header-title">ğŸ¦™ LLaMA3 8B Chat Playground</div>

                <!-- âœ… ëŒ€í™” ì´ˆê¸°í™” ë²„íŠ¼: í—¤ë” ìš°ì¸¡ì— ì‘ê²Œ ë°°ì¹˜ -->
                <button id="resetChat" type="button" class="reset-chat-btn">Reset Chat</button>

                <!-- âœ… resetì€ ì„œë²„ê°€ redirectë¡œ ì²˜ë¦¬í•˜ëŠ” êµ¬ì¡°ì— ë§ì¶° FORMìœ¼ë¡œ ì œì¶œ -->
                <form id="resetChatForm" method="post" style="display:none;">
                    <input type="hidden" name="action" value="reset_chat">
                </form>
            </header>

            <div class="chat-wrapper">
                <div class="chat">
                    {% for msg in chat_history %}
                    <div class="msg {{ msg.role }}">{{ msg.content }}</div>
                    {% endfor %}
                </div>
            </div>

            <div class="input-bar">
                <div class="input-inner">
                    <textarea id="prompt" rows="2" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    <button id="send" type="button">Send</button>
                </div>
            </div>
        </div>

        <!-- RIGHT -->
        <form id="paramForm" method="post" class="settings">
            <h3>System Prompt</h3>
            <textarea name="system_prompt" rows="4" style="width:100%">{{ system_prompt }}</textarea>

            <h3>Hyper Parameters</h3>

            <div class="param">
                <label>Temperature (ëœë¤ì„±)</label>
                <div class="param-row">
                    <input id="temperature" type="range" min="0.1" max="1.5" step="0.1"
                           value="{{ params.temperature }}">
                    <input id="temperature_num" name="temperature" type="number" min="0.1" max="1.5" step="0.1"
                           value="{{ params.temperature }}">
                </div>
            </div>

            <div class="param">
                <label>Top-p (Nucleus Sampling)</label>
                <div class="param-row">
                    <input id="top_p" type="range" min="0.1" max="1" step="0.05" value="{{ params.top_p }}">
                    <input id="top_p_num" name="top_p" type="number" min="0.1" max="1" step="0.05"
                           value="{{ params.top_p }}">
                </div>
            </div>

            <div class="param">
                <label>Top-k (í™•ë¥  ìƒìœ„ kê°œ í† í°)</label>
                <div class="param-row">
                    <input id="top_k" type="range" min="0" max="100" step="1" value="{{ params.top_k }}">
                    <input id="top_k_num" name="top_k" type="number" min="0" max="100" step="1"
                           value="{{ params.top_k }}">
                </div>
            </div>

            <div class="param">
                <label>Max Tokens (ì‘ë‹µ ê¸¸ì´ ìƒí•œ)</label>
                <div class="param-row">
                    <input id="max_tokens" type="range" min="32" max="2048" step="32" value="{{ params.max_tokens }}">
                    <input id="max_tokens_num" name="max_tokens" type="number" min="32" max="2048" step="32"
                           value="{{ params.max_tokens }}">
                </div>
            </div>

            <div class="param">
                <label>Repetition Penalty (ì¤‘ë³µ ì–µì œ)</label>
                <div class="param-row">
                    <input id="repetition_penalty" type="range" min="1" max="1.5" step="0.05"
                           value="{{ params.repetition_penalty }}">
                    <input id="repetition_penalty_num" name="repetition_penalty" type="number" min="1" max="1.5"
                           step="0.05" value="{{ params.repetition_penalty }}">
                </div>
            </div>

            <input type="hidden" name="action" value="apply_params">

            <button type="button" id="resetParams"
                    style="width:100%; padding:10px; border-radius:8px;
                       border:1px solid #1e293b; background:#334155;
                       color:white; cursor:pointer; margin-top:12px;">
                Reset to Default
            </button>

            <button class="apply" type="submit">Apply Settings</button>
        </form>

    </div>
</div>
</body>
</html>
