<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <title>LLaMA3 Chat Playground</title>

    <!-- âœ… ë„¤ë¹„ê²Œì´ì…˜ ë°”ê°€ Bootstrap ê¸°ë°˜ì´ë¯€ë¡œ llama.htmlì—ì„œë§Œ Bootstrap ë¡œë“œ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        :root{
          /* =========================
             âœ… MODERN "SOFT DARK" (ë„ˆë¬´ ì–´ë‘¡ì§€ë„/ë°ì§€ë„ ì•Šê²Œ)
             - ë„¤ë¹„ë°”ëŠ” ê·¸ëŒ€ë¡œ(ì•„ë˜ 'predict-navbar' ì„¹ì…˜ ìˆ˜ì • ê¸ˆì§€)
          ========================= */
          --bg: #0f172a;               /* ì „ì²´ ë°°ê²½(ë”¥ ë„¤ì´ë¹„) */
          --bg-2: #111c2f;             /* ê·¸ë¼ë°ì´ì…˜ ë³´ì¡° */
          --panel: rgba(17, 24, 39, 0.78);   /* íŒ¨ë„(ìœ ë¦¬ ëŠë‚Œ) */
          --panel-solid: #111827;      /* ê³ ì • íŒ¨ë„ */
          --surface: rgba(255,255,255,0.06);/* ì¹´ë“œ/ë²„ë¸”ìš© í‘œë©´ */
          --surface-2: rgba(255,255,255,0.08);
          --border: rgba(148,163,184,0.18);
          --border-2: rgba(148,163,184,0.26);
          --shadow: 0 14px 40px rgba(0,0,0,0.35);

          --text: #e5e7eb;
          --muted: #94a3b8;

          /* í¬ì¸íŠ¸ ì»¬ëŸ¬(ë¡œê³  ì£¼í™© + ë¸”ë£¨) */
          --brand: #ff6b00;
          --primary: #3b82f6;

          /* ë§í’ì„  */
          --assistant: rgba(148,163,184,0.12);
          --assistant-strong: rgba(148,163,184,0.16);

          --nav-h: 70px; /* âœ… ë„¤ë¹„ ë†’ì´(ìš”êµ¬ì‚¬í•­) */
        }

        * { box-sizing: border-box; font-family: Pretendard, sans-serif; }

        html, body { margin:0; padding:0; height:100%; }

        body{
          color: var(--text);
          overflow: hidden; /* âœ… í˜ì´ì§€ ìŠ¤í¬ë¡¤ ì œê±° */
          background:
            radial-gradient(1200px 700px at 18% 0%, rgba(255,107,0,0.10), transparent 60%),
            radial-gradient(900px 600px at 85% 15%, rgba(59,130,246,0.14), transparent 55%),
            linear-gradient(180deg, var(--bg) 0%, var(--bg-2) 100%);
        }

        /* âœ… ë„¤ë¹„+ì•± ì „ì²´ë¥¼ í•œ í™”ë©´ì— ê³ ì • */
        .page-wrapper{
          height: 100vh;
          display: flex;
          flex-direction: column;
          overflow: hidden;
        }

        /* âœ… ì•± ì˜ì—­: ë„¤ë¹„ ë†’ì´ë§Œí¼ ì œì™¸ */
        .app{
          height: calc(100vh - var(--nav-h));
          display: grid;
          grid-template-columns: 1fr 380px;
          overflow: hidden;
        }

        /* ===== LEFT ===== */
        .main{
          display:flex;
          flex-direction:column;
          height:100%;
          min-height:0;
          background: transparent;
        }

        header{
          padding: 12px 18px;
          border-bottom: 1px solid var(--border);
          font-weight: 900;
          display:flex;
          align-items:center;
          justify-content:space-between;
          gap:12px;
          min-height: 56px;

          /* âœ… ëª¨ë˜í•œ ë°˜íˆ¬ëª… í—¤ë” */
          background: linear-gradient(180deg, rgba(17,24,39,0.70) 0%, rgba(17,24,39,0.52) 100%);
          backdrop-filter: blur(10px);
        }

        .header-title{
          display:flex;
          align-items:center;
          gap:10px;
          min-width:0;
          white-space:nowrap;
          overflow:hidden;
          text-overflow:ellipsis;
          letter-spacing: -0.2px;
        }

        .header-title::before{
          content:"ğŸ¦™";
          opacity: 0.95;
        }

        /* âœ… ëŒ€í™” ì´ˆê¸°í™” ë²„íŠ¼: ìœ„í—˜ë„ ë‚®ê²Œ(ì‘ê²Œ/í—¤ë” ìš°ì¸¡/ì°¨ë¶„í•œ ê²½ê³ í†¤) */
        .reset-chat-btn{
          padding: 8px 12px;
          border-radius: 999px;
          border: 1px solid rgba(248,113,113,0.45);
          background: rgba(248,113,113,0.10);
          color: #fecaca;
          cursor: pointer;
          font-weight: 800;
          font-size: 13px;
          line-height: 1;
          white-space: nowrap;
          transition: transform .12s ease, background .12s ease, border-color .12s ease;
        }
        .reset-chat-btn:hover{
          background: rgba(248,113,113,0.14);
          border-color: rgba(248,113,113,0.70);
          transform: translateY(-1px);
        }
        .reset-chat-btn:active{ transform: translateY(0px); }
        .reset-chat-btn:disabled{ opacity:.55; cursor:not-allowed; transform:none; }

        .chat-wrapper{
          flex:1;
          min-height:0;
          overflow-y:auto;
          padding: 22px;
        }

        .chat{
          max-width: 920px;
          margin: 0 auto;
        }

        .msg{
          max-width: 75%;
          padding: 12px 16px;
          border-radius: 16px;
          margin-bottom: 14px;
          line-height: 1.65;
          white-space: pre-wrap;
          word-break: break-word;

          background: var(--surface);
          border: 1px solid var(--border);
          box-shadow: 0 10px 26px rgba(0,0,0,0.22);
        }

        .msg.user{
          margin-left:auto;
          background: linear-gradient(180deg, rgba(59,130,246,0.92), rgba(59,130,246,0.78));
          border-color: rgba(59,130,246,0.28);
          color:#fff;
        }

        .msg.assistant{
          margin-right:auto;
          background: linear-gradient(180deg, var(--assistant-strong), var(--assistant));
          border-color: var(--border);
          color: var(--text);
        }

        .msg.typing{
          margin-right:auto;
          background: linear-gradient(180deg, var(--assistant-strong), var(--assistant));
          color: var(--muted);
          font-style: italic;
        }

        .msg.typing::after{
          content:"...";
          animation: dots 1.2s infinite;
        }

        @keyframes dots{
          0% { content: "."; }
          33% { content: ".."; }
          66% { content: "..."; }
        }

        /* ===== Input ===== */
        .input-bar{
          border-top: 1px solid var(--border);
          padding: 14px 18px;
          background: linear-gradient(180deg, rgba(17,24,39,0.56) 0%, rgba(17,24,39,0.70) 100%);
          backdrop-filter: blur(10px);
        }

        .input-inner{
          max-width: 920px;
          margin: 0 auto;
          display:flex;
          gap: 10px;
          align-items: stretch;
        }

        textarea#prompt{
          flex:1;
          resize:none;
          padding: 12px 12px;
          border-radius: 14px;
          background: rgba(15,23,42,0.55);
          border: 1px solid var(--border);
          color: var(--text);
          outline: none;
          box-shadow: 0 10px 26px rgba(0,0,0,0.18);
        }
        textarea#prompt::placeholder{ color: rgba(148,163,184,0.85); }
        textarea#prompt:focus{
          border-color: rgba(59,130,246,0.55);
          box-shadow:
            0 14px 34px rgba(59,130,246,0.16),
            0 0 0 4px rgba(59,130,246,0.12);
          background: rgba(15,23,42,0.68);
        }

        button{
          padding: 0 20px;
          border-radius: 14px;
          border: 1px solid rgba(59,130,246,0.30);
          background: linear-gradient(180deg, rgba(59,130,246,0.95), rgba(59,130,246,0.78));
          color: #fff;
          cursor: pointer;
          font-weight: 900;
          box-shadow: 0 12px 28px rgba(59,130,246,0.18);
          transition: transform .12s ease, filter .12s ease;
        }
        button:hover{ filter: brightness(1.03); transform: translateY(-1px); }
        button:active{ transform: translateY(0px); }
        button:disabled{
          opacity: 0.55;
          cursor: not-allowed;
          box-shadow: none;
          transform: none;
        }

        /* ===== RIGHT SETTINGS ===== */
        .settings{
          background: linear-gradient(180deg, rgba(17,24,39,0.78) 0%, rgba(17,24,39,0.70) 100%);
          border-left: 1px solid var(--border);
          padding: 18px 18px 22px;
          overflow-y: auto;
          backdrop-filter: blur(10px);
        }

        .settings h3{
          margin-top: 0;
          margin-bottom: 10px;
          font-weight: 950;
          letter-spacing: -0.3px;
        }

        .settings textarea[name="system_prompt"]{
          width: 100%;
          background: rgba(15,23,42,0.55) !important;
          color: var(--text) !important;
          border: 1px solid var(--border) !important;
          border-radius: 14px !important;
          padding: 10px 12px !important;
          outline: none !important;
        }
        .settings textarea[name="system_prompt"]:focus{
          border-color: rgba(255,107,0,0.60) !important;
          box-shadow: 0 0 0 4px rgba(255,107,0,0.14) !important;
          background: rgba(15,23,42,0.68) !important;
        }

        .param{ margin-bottom: 16px; }
        .param label{
          font-size: 13px;
          color: var(--muted);
          display:block;
          margin-bottom: 6px;
          font-weight: 750;
        }

        .param-row{
          display:flex;
          gap:10px;
          align-items:center;
        }

        /* âœ… range ëª¨ë˜ ìŠ¤íƒ€ì¼ */
        .param-row input[type=range]{
          flex:1;
          accent-color: var(--primary);
        }

        .param-row input[type=number]{
          width: 78px;
          background: rgba(15,23,42,0.55);
          border: 1px solid var(--border);
          color: var(--text);
          border-radius: 12px;
          padding: 6px 8px;
          outline:none;
        }
        .param-row input[type=number]:focus{
          border-color: rgba(59,130,246,0.55);
          box-shadow: 0 0 0 4px rgba(59,130,246,0.12);
          background: rgba(15,23,42,0.68);
        }

        /* âœ… Reset to Default ë²„íŠ¼: inline style ìˆì–´ë„ ë®ì–´ì“°ê¸° */
        #resetParams{
          width: 100% !important;
          padding: 12px 10px !important;
          border-radius: 14px !important;
          border: 1px solid var(--border) !important;
          background: linear-gradient(180deg, rgba(148,163,184,0.10), rgba(148,163,184,0.06)) !important;
          color: var(--text) !important;
          cursor: pointer !important;
          margin-top: 12px !important;
          font-weight: 900 !important;
          box-shadow: 0 12px 26px rgba(0,0,0,0.18) !important;
        }
        #resetParams:hover{
          filter: brightness(1.03);
          transform: translateY(-1px);
        }

        /* âœ… Apply ë²„íŠ¼: ë¸Œëœë“œ(ì£¼í™©) ì‚¬ìš© */
        .apply{
          width: 100%;
          padding: 12px 10px;
          border-radius: 14px;
          border: 1px solid rgba(255,107,0,0.28);
          background: linear-gradient(180deg, rgba(255,107,0,0.96), rgba(255,107,0,0.78));
          color: #fff;
          cursor: pointer;
          margin-top: 12px;
          font-weight: 950;
          box-shadow: 0 14px 30px rgba(255,107,0,0.18);
          transition: transform .12s ease, filter .12s ease;
        }
        .apply:hover{ filter: brightness(1.03); transform: translateY(-1px); }
        .apply:active{ transform: translateY(0px); }

        /* ===== OVERLAY (Apply/Reset ì¤‘ ì ê¸ˆ) ===== */
        .overlay{
          position: fixed;
          inset: 0;
          background: rgba(0,0,0,0.45);
          backdrop-filter: blur(2px);
          display: none;
          align-items: center;
          justify-content: center;
          z-index: 9999;
          pointer-events: all;
        }

        .overlay-box{
          background: rgba(17,24,39,0.92);
          border: 1px solid var(--border-2);
          color: var(--text);
          padding: 20px 26px;
          border-radius: 16px;
          font-size: 15px;
          font-weight: 900;
          box-shadow: var(--shadow);
          backdrop-filter: blur(10px);
        }

        /* ======================================
           âœ… ì „ì›”ì„¸ ì§€ë„ í˜ì´ì§€ ì „ìš© ë„¤ë¹„ê²Œì´ì…˜ë°” CSS (ê³µìš©) - ìˆ˜ì • ê¸ˆì§€
        ====================================== */
        .predict-navbar {
          background: linear-gradient(90deg, #0b1d33, #0f2a52);
          height: var(--nav-h);
          padding: 0 2rem !important;
          border-bottom: none;
        }

        .predict-navbar .nav-link {
          color: #fff !important;
          font-weight: 500;
          font-size: 1rem;
          transition: color 0.25s ease, transform 0.25s ease;
          display: inline-block;
        }

        .predict-navbar .nav-link:hover {
          color: #ff6b00 !important;
          transform: translateY(-2px);
        }

        .predict-navbar .navbar-brand img {
          height: 40px;
          filter: brightness(1.1);
        }

        .predict-navbar .navbar-toggler {
          border-color: rgba(255,255,255,0.5);
        }

        .predict-navbar .navbar-toggler-icon {
          filter: brightness(200%);
        }

        /* âœ… ìŠ¤í¬ë¡¤ë°”(ëª¨ë˜ ë‹¤í¬) */
        .chat-wrapper::-webkit-scrollbar,
        .settings::-webkit-scrollbar { width: 10px; }

        .chat-wrapper::-webkit-scrollbar-thumb,
        .settings::-webkit-scrollbar-thumb{
          background: rgba(148,163,184,0.28);
          border-radius: 999px;
          border: 2px solid rgba(17,24,39,0.55);
        }

        .chat-wrapper::-webkit-scrollbar-track,
        .settings::-webkit-scrollbar-track{
          background: rgba(0,0,0,0);
        }

        /* âœ… ì‘ì€ í™”ë©´ ëŒ€ì‘ */
        @media (max-width: 992px){
          .app{ grid-template-columns: 1fr; }
          .settings{ display:none; }
        }
    </style>

    <script>
        /* =========================================================
           DEFAULT PRESET (ì´ˆê¸°ê°’)
        ========================================================= */
        const DEFAULT_PRESET = {
          temperature: 0.7,
          top_p: 0.9,
          top_k: 50,
          max_tokens: 512,
          repetition_penalty: 1.1
        };

        /* =========================================================
           Utility
        ========================================================= */
        function scrollToBottom(wrapper) {
          requestAnimationFrame(() => {
            wrapper.scrollTop = wrapper.scrollHeight;
          });
        }

        // range <-> number ë™ê¸°í™” (ì–‘ë°©í–¥ + clamp)
        function bindRangeNumber(rangeEl, numberEl) {
          if (!rangeEl || !numberEl) return;

          const min = Number(rangeEl.min);
          const max = Number(rangeEl.max);
          const step = Number(rangeEl.step || 1);

          const clampToStep = (val) => {
            if (Number.isNaN(val)) return Number(rangeEl.value);
            let v = Math.min(max, Math.max(min, val));
            const decimals = (String(step).split(".")[1] || "").length;
            const snapped = Math.round((v - min) / step) * step + min;
            return Number(snapped.toFixed(decimals));
          };

          const syncFromRange = () => {
            numberEl.value = rangeEl.value;
          };

          const syncFromNumber = () => {
            const v = clampToStep(Number(numberEl.value));
            rangeEl.value = String(v);
            numberEl.value = String(v);
          };

          rangeEl.addEventListener("input", syncFromRange);
          numberEl.addEventListener("input", () => {
            const raw = Number(numberEl.value);
            if (Number.isNaN(raw)) return;
            rangeEl.value = Math.min(max, Math.max(min, raw));
          });
          numberEl.addEventListener("change", syncFromNumber);
          numberEl.addEventListener("blur", syncFromNumber);

          syncFromRange();
        }

        // overlay í‘œì‹œ/ìˆ¨ê¹€ + ì „ì²´ UI ì ê¸ˆ
        function setOverlay(show, text) {
          const overlay = document.getElementById("overlay");
          const box = document.getElementById("overlayText");

          if (text) box.textContent = text;
          overlay.style.display = show ? "flex" : "none";

          if (show) {
            document.body.dataset.prevOverflow = document.body.style.overflow || "";
            document.body.style.overflow = "hidden";
          } else {
            document.body.style.overflow = document.body.dataset.prevOverflow || "";
            delete document.body.dataset.prevOverflow;
          }
        }

        // íŒŒë¼ë¯¸í„° ê°’ ì„¸íŒ… (range + number ë™ì‹œì—)
        function setParam(id, value) {
          const range = document.getElementById(id);
          const num = document.getElementById(id + "_num");
          if (!range || !num) return;

          range.value = value;
          num.value = value;
          range.dispatchEvent(new Event("input"));
        }

        document.addEventListener("DOMContentLoaded", () => {
          /* =======================
             Elements
          ======================= */
          const textarea = document.getElementById("prompt");
          const sendBtn = document.getElementById("send");
          const resetChatBtn = document.getElementById("resetChat");
          const resetChatForm = document.getElementById("resetChatForm");

          const chat = document.querySelector(".chat");
          const wrapper = document.querySelector(".chat-wrapper");

          const temperature = document.getElementById("temperature");
          const temperature_num = document.getElementById("temperature_num");
          const top_p = document.getElementById("top_p");
          const top_p_num = document.getElementById("top_p_num");
          const top_k = document.getElementById("top_k");
          const top_k_num = document.getElementById("top_k_num");
          const max_tokens = document.getElementById("max_tokens");
          const max_tokens_num = document.getElementById("max_tokens_num");
          const repetition_penalty = document.getElementById("repetition_penalty");
          const repetition_penalty_num = document.getElementById("repetition_penalty_num");

          scrollToBottom(wrapper);

          /* =======================
             Send enable/disable
          ======================= */
          sendBtn.disabled = true;
          textarea.addEventListener("input", () => {
            sendBtn.disabled = textarea.value.trim() === "";
          });

          textarea.addEventListener("keydown", (e) => {
            if (e.key === "Enter" && !e.shiftKey) {
              e.preventDefault();
              if (!sendBtn.disabled) sendBtn.click();
            }
          });

          /* =======================
             Chat Send (JSON)
          ======================= */
          let isSending = false;
          let isResetting = false;

          sendBtn.addEventListener("click", async () => {
            if (isSending || isResetting) return;

            const text = textarea.value.trim();
            if (!text) return;

            isSending = true;

            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¦‰ì‹œ ì¶”ê°€
            const userMsg = document.createElement("div");
            userMsg.className = "msg user";
            userMsg.innerText = text;
            chat.appendChild(userMsg);

            // typing ì¶”ê°€
            const typing = document.createElement("div");
            typing.className = "msg assistant typing";
            typing.innerText = "";
            chat.appendChild(typing);

            scrollToBottom(wrapper);

            // ì…ë ¥ ì ê¸ˆ
            textarea.value = "";
            textarea.disabled = true;
            sendBtn.disabled = true;
            resetChatBtn.disabled = true;

            try {
              const res = await fetch("/llama", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ prompt: text })
              });

              if (!res.ok) throw new Error("HTTP " + res.status);

              const ct = res.headers.get("content-type") || "";
              if (!ct.includes("application/json")) {
                throw new Error("Invalid response type");
              }

              const data = await res.json();

              typing.remove();

              const botMsg = document.createElement("div");
              botMsg.className = "msg assistant";
              botMsg.innerText = (data && data.answer) ? data.answer : "(ë¹ˆ ì‘ë‹µ)";
              chat.appendChild(botMsg);

              scrollToBottom(wrapper);

            } catch (err) {
              typing.remove();

              const errMsg = document.createElement("div");
              errMsg.className = "msg assistant";
              errMsg.innerText = "âš ï¸ ì˜¤ë¥˜ ë°œìƒ\n" + err;
              chat.appendChild(errMsg);

              scrollToBottom(wrapper);
            } finally {
              textarea.disabled = false;
              textarea.focus();
              isSending = false;

              sendBtn.disabled = true;       // í…ìŠ¤íŠ¸ ë¹„ì–´ìˆìŒ
              resetChatBtn.disabled = false; // ë‹¤ì‹œ í™œì„±í™”
            }
          });

          /* =======================
             âœ… Chat Reset (FORM)
             - ì„œë²„ê°€ redirect/HTMLë¡œ ì‘ë‹µí•´ë„ ì‹¤íŒ¨í•˜ì§€ ì•Šê²Œ
             - confirm + overlay
          ======================= */
          resetChatBtn.addEventListener("click", () => {
            if (isSending || isResetting) return;

            const ok = confirm("ëŒ€í™” ë‚´ì—­ì„ ëª¨ë‘ ì´ˆê¸°í™”í• ê¹Œìš”?\n(ìƒˆë¡œê³ ì¹¨í•´ë„ ë³µêµ¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤)");
            if (!ok) return;

            isResetting = true;

            textarea.disabled = true;
            sendBtn.disabled = true;
            resetChatBtn.disabled = true;

            setOverlay(true, "ëŒ€í™” ì´ˆê¸°í™”ì¤‘ì…ë‹ˆë‹¤â€¦");

            // âœ… JSON fetch ëŒ€ì‹  FORM submit (ì„œë²„ redirect êµ¬ì¡°ì™€ 100% í˜¸í™˜)
            resetChatForm.submit();
          });

          /* =======================
             Hyper Parameter Sync
          ======================= */
          bindRangeNumber(temperature, temperature_num);
          bindRangeNumber(top_p, top_p_num);
          bindRangeNumber(top_k, top_k_num);
          bindRangeNumber(max_tokens, max_tokens_num);
          bindRangeNumber(repetition_penalty, repetition_penalty_num);

          /* =======================
             Reset Params Button
          ======================= */
          const resetParamsBtn = document.getElementById("resetParams");
          resetParamsBtn.addEventListener("click", () => {
            setParam("temperature", DEFAULT_PRESET.temperature);
            setParam("top_p", DEFAULT_PRESET.top_p);
            setParam("top_k", DEFAULT_PRESET.top_k);
            setParam("max_tokens", DEFAULT_PRESET.max_tokens);
            setParam("repetition_penalty", DEFAULT_PRESET.repetition_penalty);
          });

          /* =======================
             Apply Params Overlay
          ======================= */
          const paramForm = document.getElementById("paramForm");
          paramForm.addEventListener("submit", () => {
            setOverlay(true, "í”„ë¡¬í”„íŠ¸&í•˜ì´í¼íŒŒë¼ë¯¸í„° ì ìš©ì¤‘ì…ë‹ˆë‹¤â€¦");
          });

          /* =======================
             overlay ìœ„ì—ì„œ ì´ë²¤íŠ¸ ë¨¹ê¸° (ì™„ì „ ì ê¸ˆ)
          ======================= */
          const overlay = document.getElementById("overlay");
          overlay.addEventListener("click", (e) => e.preventDefault());
          overlay.addEventListener("wheel", (e) => e.preventDefault(), { passive: false });
          document.addEventListener("keydown", (e) => {
            if (overlay.style.display === "flex") e.preventDefault();
          }, { capture: true });
        });
    </script>
</head>

<body>
<div class="overlay" id="overlay">
    <div class="overlay-box" id="overlayText">í”„ë¡¬í”„íŠ¸&í•˜ì´í¼íŒŒë¼ë¯¸í„° ì ìš©ì¤‘ì…ë‹ˆë‹¤â€¦</div>
</div>

<div class="page-wrapper">

    <!-- âœ… NAVIGATION BAR (ê³µìš©) - ìˆ˜ì • ê¸ˆì§€ -->
    <nav class="navbar navbar-expand-lg predict-navbar">
        <div class="container-fluid px-4">

            <a class="navbar-brand" href="{{ url_for('index.index') }}">
                <img src="{{ url_for('static', filename='image/logo2.png') }}"
                     alt="ì²­ë…„ ì£¼ê±° ì†”ë£¨ì…˜ ë¡œê³ "
                     style="height:40px; width:auto;">
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#topNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="topNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item ms-3">
                        <a class="nav-link" href="{{ url_for('predict.predict_search') }}">ì „ì›”ì„¸ ì˜ˆì¸¡</a>
                    </li>
                    <li class="nav-item ms-3">
                        <a class="nav-link" href="{{ url_for('support.support_search') }}">ì •ë¶€ì§€ì›</a>
                    </li>
                    <li class="nav-item ms-3">
                        <a class="nav-link" href="{{ url_for('login.login') }}">ë¡œê·¸ì¸</a>
                    </li>
                    <li class="nav-item ms-3">
                        <a class="nav-link" href="{{ url_for('login.signup') }}">íšŒì›ê°€ì…</a>
                    </li>
                </ul>
            </div>

        </div>
    </nav>

    <!-- âœ… llama ì•± (ê¸°ëŠ¥/êµ¬ì¡° ê·¸ëŒ€ë¡œ) -->
    <div class="app">

        <!-- LEFT -->
        <div class="main">
            <header>
                <div class="header-title">LLaMA3 8B Chat</div>

                <!-- âœ… ëŒ€í™” ì´ˆê¸°í™” ë²„íŠ¼: í—¤ë” ìš°ì¸¡ì— ì‘ê²Œ ë°°ì¹˜ -->
                <button id="resetChat" type="button" class="reset-chat-btn">Reset Chat</button>

                <!-- âœ… resetì€ ì„œë²„ê°€ redirectë¡œ ì²˜ë¦¬í•˜ëŠ” êµ¬ì¡°ì— ë§ì¶° FORMìœ¼ë¡œ ì œì¶œ -->
                <form id="resetChatForm" method="post" style="display:none;">
                    <input type="hidden" name="action" value="reset_chat">
                </form>
            </header>

            <div class="chat-wrapper">
                <div class="chat">
                    {% for msg in chat_history %}
                    <div class="msg {{ msg.role }}">{{ msg.content }}</div>
                    {% endfor %}
                </div>
            </div>

            <div class="input-bar">
                <div class="input-inner">
                    <textarea id="prompt" rows="2" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    <button id="send" type="button">Send</button>
                </div>
            </div>
        </div>

        <!-- RIGHT -->
        <form id="paramForm" method="post" class="settings">
            <h3>System Prompt</h3>
            <textarea name="system_prompt" rows="4">{{ system_prompt }}</textarea>

            <h3 style="margin-top:16px;">Hyper Parameters</h3>

            <div class="param">
                <label>Temperature (ëœë¤ì„±)</label>
                <div class="param-row">
                    <input id="temperature" type="range" min="0.1" max="1.5" step="0.1"
                           value="{{ params.temperature }}">
                    <input id="temperature_num" name="temperature" type="number" min="0.1" max="1.5" step="0.1"
                           value="{{ params.temperature }}">
                </div>
            </div>

            <div class="param">
                <label>Top-p (Nucleus Sampling)</label>
                <div class="param-row">
                    <input id="top_p" type="range" min="0.1" max="1" step="0.05" value="{{ params.top_p }}">
                    <input id="top_p_num" name="top_p" type="number" min="0.1" max="1" step="0.05"
                           value="{{ params.top_p }}">
                </div>
            </div>

            <div class="param">
                <label>Top-k (í™•ë¥  ìƒìœ„ kê°œ í† í°)</label>
                <div class="param-row">
                    <input id="top_k" type="range" min="0" max="100" step="1" value="{{ params.top_k }}">
                    <input id="top_k_num" name="top_k" type="number" min="0" max="100" step="1"
                           value="{{ params.top_k }}">
                </div>
            </div>

            <div class="param">
                <label>Max Tokens (ì‘ë‹µ ê¸¸ì´ ìƒí•œ)</label>
                <div class="param-row">
                    <input id="max_tokens" type="range" min="32" max="2048" step="32" value="{{ params.max_tokens }}">
                    <input id="max_tokens_num" name="max_tokens" type="number" min="32" max="2048" step="32"
                           value="{{ params.max_tokens }}">
                </div>
            </div>

            <div class="param">
                <label>Repetition Penalty (ì¤‘ë³µ ì–µì œ)</label>
                <div class="param-row">
                    <input id="repetition_penalty" type="range" min="1" max="1.5" step="0.05"
                           value="{{ params.repetition_penalty }}">
                    <input id="repetition_penalty_num" name="repetition_penalty" type="number" min="1" max="1.5"
                           step="0.05" value="{{ params.repetition_penalty }}">
                </div>
            </div>

            <input type="hidden" name="action" value="apply_params">

            <!-- (ê¸°ì¡´ inline styleì´ ìˆì–´ë„ CSSì—ì„œ #resetParamsë¡œ ë®ì–´ì”€) -->
            <button type="button" id="resetParams"
                    style="width:100%; padding:10px; border-radius:8px;
                       border:1px solid #1e293b; background:#334155;
                       color:white; cursor:pointer; margin-top:12px;">
                Reset to Default
            </button>

            <button class="apply" type="submit">Apply Settings</button>
        </form>

    </div>
</div>
</body>
</html>
