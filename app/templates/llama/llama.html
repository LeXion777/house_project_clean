<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <title>LLaMA3 Chat Playground</title>

    <!-- ‚úÖ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î∞îÍ∞Ä Bootstrap Í∏∞Î∞òÏù¥ÎØÄÎ°ú llama.htmlÏóêÏÑúÎßå Bootstrap Î°úÎìú -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        :root{
          /* =========================
             ‚úÖ MODERN "SOFT DARK" (ÎÑàÎ¨¥ Ïñ¥Îë°ÏßÄÎèÑ/Î∞ùÏßÄÎèÑ ÏïäÍ≤å)
             - ÎÑ§ÎπÑÎ∞îÎäî Í∑∏ÎåÄÎ°ú(ÏïÑÎûò 'predict-navbar' ÏÑπÏÖò ÏàòÏ†ï Í∏àÏßÄ)
          ========================= */
          --bg: #0f172a;
          --bg-2: #111c2f;
          --panel: rgba(17, 24, 39, 0.78);
          --panel-solid: #111827;
          --surface: rgba(255,255,255,0.06);
          --surface-2: rgba(255,255,255,0.08);
          --border: rgba(148,163,184,0.18);
          --border-2: rgba(148,163,184,0.26);
          --shadow: 0 14px 40px rgba(0,0,0,0.35);

          --text: #e5e7eb;
          --muted: #94a3b8;

          --brand: #ff6b00;
          --primary: #3b82f6;

          --assistant: rgba(148,163,184,0.12);
          --assistant-strong: rgba(148,163,184,0.16);

          --nav-h: 70px; /* ‚úÖ ÎÑ§ÎπÑ ÎÜíÏù¥ */
        }

        * { box-sizing: border-box; font-family: Pretendard, sans-serif; }
        html, body { margin:0; padding:0; height:100%; }

        body{
          color: var(--text);
          overflow: hidden;
          background:
            radial-gradient(1200px 700px at 18% 0%, rgba(255,107,0,0.10), transparent 60%),
            radial-gradient(900px 600px at 85% 15%, rgba(59,130,246,0.14), transparent 55%),
            linear-gradient(180deg, var(--bg) 0%, var(--bg-2) 100%);
        }

        .page-wrapper{
          height: 100vh;
          display: flex;
          flex-direction: column;
          overflow: hidden;
        }

        .app{
          height: calc(100vh - var(--nav-h));
          display: grid;
          grid-template-columns: 1fr 380px;
          overflow: hidden;
        }

        /* ===== LEFT ===== */
        .main{
          display:flex;
          flex-direction:column;
          height:100%;
          min-height:0;
          background: transparent;
        }

        header{
          padding: 12px 18px;
          border-bottom: 1px solid var(--border);
          font-weight: 900;
          display:flex;
          align-items:center;
          justify-content:space-between;
          gap:12px;
          min-height: 56px;
          background: linear-gradient(180deg, rgba(17,24,39,0.70) 0%, rgba(17,24,39,0.52) 100%);
          backdrop-filter: blur(10px);
        }

        .header-title{
          display:flex;
          align-items:center;
          gap:10px;
          min-width:0;
          white-space:nowrap;
          overflow:hidden;
          text-overflow:ellipsis;
          letter-spacing: -0.2px;
        }

        .header-title::before{
          content:"ü¶ô";
          opacity: 0.95;
        }

        .reset-chat-btn{
          padding: 8px 12px;
          border-radius: 999px;
          border: 1px solid rgba(248,113,113,0.45);
          background: rgba(248,113,113,0.10);
          color: #fecaca;
          cursor: pointer;
          font-weight: 800;
          font-size: 13px;
          line-height: 1;
          white-space: nowrap;
          transition: transform .12s ease, background .12s ease, border-color .12s ease;
        }
        .reset-chat-btn:hover{
          background: rgba(248,113,113,0.14);
          border-color: rgba(248,113,113,0.70);
          transform: translateY(-1px);
        }
        .reset-chat-btn:active{ transform: translateY(0px); }
        .reset-chat-btn:disabled{ opacity:.55; cursor:not-allowed; transform:none; }

        .chat-wrapper{
          flex:1;
          min-height:0;
          overflow-y:auto;
          padding: 22px;
        }

        .chat{
          max-width: 920px;
          margin: 0 auto;
        }

        .msg{
          max-width: 75%;
          padding: 12px 16px;
          border-radius: 16px;
          margin-bottom: 14px;
          line-height: 1.65;
          white-space: pre-wrap;
          word-break: break-word;

          background: var(--surface);
          border: 1px solid var(--border);
          box-shadow: 0 10px 26px rgba(0,0,0,0.22);
        }

        .msg.user{
          margin-left:auto;
          background: linear-gradient(180deg, rgba(59,130,246,0.92), rgba(59,130,246,0.78));
          border-color: rgba(59,130,246,0.28);
          color:#fff;
        }

        .msg.assistant{
          margin-right:auto;
          background: linear-gradient(180deg, var(--assistant-strong), var(--assistant));
          border-color: var(--border);
          color: var(--text);
        }

        .msg.typing{
          margin-right:auto;
          background: linear-gradient(180deg, var(--assistant-strong), var(--assistant));
          color: var(--muted);
          font-style: italic;
        }

        .msg.typing::after{
          content:"...";
          animation: dots 1.2s infinite;
        }

        @keyframes dots{
          0% { content: "."; }
          33% { content: ".."; }
          66% { content: "..."; }
        }

        .input-bar{
          border-top: 1px solid var(--border);
          padding: 14px 18px;
          background: linear-gradient(180deg, rgba(17,24,39,0.56) 0%, rgba(17,24,39,0.70) 100%);
          backdrop-filter: blur(10px);
        }

        .input-inner{
          max-width: 920px;
          margin: 0 auto;
          display:flex;
          gap: 10px;
          align-items: stretch;
        }

        textarea#prompt{
          flex:1;
          resize:none;
          padding: 12px 12px;
          border-radius: 14px;
          background: rgba(15,23,42,0.55);
          border: 1px solid var(--border);
          color: var(--text);
          outline: none;
          box-shadow: 0 10px 26px rgba(0,0,0,0.18);
        }
        textarea#prompt::placeholder{ color: rgba(148,163,184,0.85); }
        textarea#prompt:focus{
          border-color: rgba(59,130,246,0.55);
          box-shadow:
            0 14px 34px rgba(59,130,246,0.16),
            0 0 0 4px rgba(59,130,246,0.12);
          background: rgba(15,23,42,0.68);
        }

        button{
          padding: 0 20px;
          border-radius: 14px;
          border: 1px solid rgba(59,130,246,0.30);
          background: linear-gradient(180deg, rgba(59,130,246,0.95), rgba(59,130,246,0.78));
          color: #fff;
          cursor: pointer;
          font-weight: 900;
          box-shadow: 0 12px 28px rgba(59,130,246,0.18);
          transition: transform .12s ease, filter .12s ease;
        }
        button:hover{ filter: brightness(1.03); transform: translateY(-1px); }
        button:active{ transform: translateY(0px); }
        button:disabled{
          opacity: 0.55;
          cursor: not-allowed;
          box-shadow: none;
          transform: none;
        }

        /* ===== RIGHT SETTINGS ===== */
        .settings{
          background: linear-gradient(180deg, rgba(17,24,39,0.78) 0%, rgba(17,24,39,0.70) 100%);
          border-left: 1px solid var(--border);
          padding: 18px 18px 22px;
          overflow-y: auto;
          backdrop-filter: blur(10px);
        }

        .settings h3{
          margin-top: 0;
          margin-bottom: 10px;
          font-weight: 950;
          letter-spacing: -0.3px;
        }

        /* ‚úÖ ÌòÑÌô©Ìåê */
        .status-card{
          background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.04));
          border: 1px solid var(--border);
          border-radius: 16px;
          padding: 14px 14px 12px;
          box-shadow: 0 12px 28px rgba(0,0,0,0.18);
          margin-bottom: 14px;
        }
        .status-top{
          display:flex;
          align-items:center;
          justify-content:space-between;
          gap:10px;
          margin-bottom: 10px;
        }
        .status-title{
          font-weight: 950;
          letter-spacing: -0.2px;
          display:flex;
          align-items:center;
          gap:8px;
        }
        .status-badge{
          font-size: 12px;
          font-weight: 900;
          padding: 6px 10px;
          border-radius: 999px;
          border: 1px solid rgba(255,107,0,0.30);
          background: rgba(255,107,0,0.10);
          color: #ffd7bf;
          white-space: nowrap;
        }
        .status-row{
          display:flex;
          gap:10px;
          align-items:flex-start;
          margin-top: 8px;
        }
        .status-label{
          width: 110px;
          flex: 0 0 110px;
          color: var(--muted);
          font-weight: 800;
          font-size: 12px;
          padding-top: 2px;
        }
        .status-value{
          flex: 1;
          min-width: 0;
          font-size: 13px;
          font-weight: 800;
          color: var(--text);
        }
        .status-ellipsis{
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
          display:block;
          max-width: 100%;
        }
        .status-grid{
          display:grid;
          grid-template-columns: 1fr 1fr;
          gap: 10px;
          margin-top: 10px;
        }
        .kv{
          background: rgba(15,23,42,0.40);
          border: 1px solid var(--border);
          border-radius: 14px;
          padding: 10px 10px;
        }
        .kv .k{
          font-size: 12px;
          font-weight: 900;
          color: var(--muted);
          margin-bottom: 2px;
        }
        .kv .v{
          font-size: 14px;
          font-weight: 950;
          color: var(--text);
          letter-spacing: -0.1px;
        }

        .settings textarea[name="system_prompt"]{
          width: 100%;
          background: rgba(15,23,42,0.55) !important;
          color: var(--text) !important;
          border: 1px solid var(--border) !important;
          border-radius: 14px !important;
          padding: 10px 12px !important;
          outline: none !important;
        }
        .settings textarea[name="system_prompt"]:focus{
          border-color: rgba(255,107,0,0.60) !important;
          box-shadow: 0 0 0 4px rgba(255,107,0,0.14) !important;
          background: rgba(15,23,42,0.68) !important;
        }

        .param{ margin-bottom: 16px; }
        .param label{
          font-size: 13px;
          color: var(--muted);
          display:block;
          margin-bottom: 6px;
          font-weight: 750;
        }

        .param-row{
          display:flex;
          gap:10px;
          align-items:center;
        }

        .param-row input[type=range]{
          flex:1;
          accent-color: var(--primary);
        }

        .param-row input[type=number]{
          width: 78px;
          background: rgba(15,23,42,0.55);
          border: 1px solid var(--border);
          color: var(--text);
          border-radius: 12px;
          padding: 6px 8px;
          outline:none;
        }
        .param-row input[type=number]:focus{
          border-color: rgba(59,130,246,0.55);
          box-shadow: 0 0 0 4px rgba(59,130,246,0.12);
          background: rgba(15,23,42,0.68);
        }

        #resetParams{
          width: 100% !important;
          padding: 12px 10px !important;
          border-radius: 14px !important;
          border: 1px solid var(--border) !important;
          background: linear-gradient(180deg, rgba(148,163,184,0.10), rgba(148,163,184,0.06)) !important;
          color: var(--text) !important;
          cursor: pointer !important;
          margin-top: 12px !important;
          font-weight: 900 !important;
          box-shadow: 0 12px 26px rgba(0,0,0,0.18) !important;
        }
        #resetParams:hover{
          filter: brightness(1.03);
          transform: translateY(-1px);
        }

        .apply{
          width: 100%;
          padding: 12px 10px;
          border-radius: 14px;
          border: 1px solid rgba(255,107,0,0.28);
          background: linear-gradient(180deg, rgba(255,107,0,0.96), rgba(255,107,0,0.78));
          color: #fff;
          cursor: pointer;
          margin-top: 12px;
          font-weight: 950;
          box-shadow: 0 14px 30px rgba(255,107,0,0.18);
          transition: transform .12s ease, filter .12s ease;
        }
        .apply:hover{ filter: brightness(1.03); transform: translateY(-1px); }
        .apply:active{ transform: translateY(0px); }

        .overlay{
          position: fixed;
          inset: 0;
          background: rgba(0,0,0,0.45);
          backdrop-filter: blur(2px);
          display: none;
          align-items: center;
          justify-content: center;
          z-index: 9999;
          pointer-events: all;
        }

        .overlay-box{
          background: rgba(17,24,39,0.92);
          border: 1px solid var(--border-2);
          color: var(--text);
          padding: 20px 26px;
          border-radius: 16px;
          font-size: 15px;
          font-weight: 900;
          box-shadow: var(--shadow);
          backdrop-filter: blur(10px);
        }

        /* ===== Fine-tuning Preset UI ===== */
        .finetune-wrap{
          margin-top: 14px;
          margin-bottom: 16px;
        }
        /* ===== Fine-tuning Header (Í∞ÄÎèÖÏÑ± Í∞úÏÑ†) ===== */
        .finetune-head{
          display:block;           /* Í∏∞Ï°¥ flex Ìï¥Ï†ú */
          margin-bottom: 12px;
        }

        .finetune-head-left{
          display:flex;
          flex-direction:column;
          gap:6px;
        }

        .finetune-head-title{
          font-size: 20px;
          font-weight: 950;
          letter-spacing: -0.3px;
          white-space: nowrap;     /* Fine-tuning Ìïú Ï§Ñ Í≥†Ï†ï */
          overflow: hidden;
          text-overflow: ellipsis; /* ÌòπÏãú Îçî Í∏∏Ïñ¥ÏßÄÎ©¥ ‚Ä¶ Ï≤òÎ¶¨ */
        }

        .finetune-head-desc{
          font-size: 12px;
          color: var(--muted);
          font-weight: 750;
          line-height: 1.35;
          word-break: keep-all;    /* ÌïúÍ∏Ä Ïñ¥ÏÉâÌïú Î∂ÑÎ¶¨ Î∞©ÏßÄ */
          overflow: hidden;

          /* ÏïàÎÇ¥Î¨∏Ïù¥ ÎÑàÎ¨¥ Í∏∏Î©¥ ÏµúÎåÄ 2Ï§ÑÍπåÏßÄÎßå */
          display: -webkit-box;
          -webkit-box-orient: vertical;
          -webkit-line-clamp: 2;
        }

        .finetune-sub{
          font-size: 12px;
          color: var(--muted);
          font-weight: 750;
          line-height: 1.25;
          text-align: right;
        }
        .finetune-grid{
          display:grid;
          grid-template-columns: 1fr;
          gap: 10px;
        }
        .finetune-card{
          position: relative;
          background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.04));
          border: 1px solid var(--border);
          border-radius: 16px;
          padding: 12px 12px 10px;
          cursor: pointer;
          box-shadow: 0 12px 28px rgba(0,0,0,0.16);
          transition: transform .12s ease, border-color .12s ease, filter .12s ease;
          user-select: none;
        }
        .finetune-card:hover{
          transform: translateY(-1px);
          filter: brightness(1.02);
        }
        .finetune-card.selected{
          border-color: rgba(255,107,0,0.55);
          box-shadow:
            0 14px 34px rgba(255,107,0,0.10),
            0 0 0 4px rgba(255,107,0,0.12);
        }
        .finetune-top{
          display:flex;
          align-items:center;
          justify-content:space-between;
          gap:10px;
          margin-bottom: 6px;
        }
        .finetune-title{
          font-weight: 950;
          letter-spacing: -0.2px;
          display:flex;
          align-items:center;
          gap:8px;
          min-width: 0;
        }
        .finetune-title span:first-child{
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
          max-width: 220px;
        }
        .finetune-title .pill{
          font-size: 11px;
          font-weight: 950;
          padding: 4px 8px;
          border-radius: 999px;
          border: 1px solid rgba(59,130,246,0.25);
          background: rgba(59,130,246,0.10);
          color: #cfe3ff;
          white-space: nowrap;
        }
        .finetune-title .pill.rec{
          border: 1px solid rgba(255,107,0,0.30);
          background: rgba(255,107,0,0.10);
          color: #ffd7bf;
        }
        .finetune-short{
          font-size: 13px;
          color: var(--text);
          font-weight: 800;
          line-height: 1.45;
        }
        .finetune-actions{
          margin-top: 8px;
          display:flex;
          align-items:center;
          justify-content:space-between;
          gap:10px;
        }
        .finetune-more{
          font-size: 12px;
          color: var(--muted);
          font-weight: 850;
          text-decoration: underline;
          cursor: pointer;
          user-select:none;
          background: transparent;
          border: none;
          padding: 0;
        }
        .finetune-radio{
          appearance: none;
          width: 16px;
          height: 16px;
          border-radius: 999px;
          border: 2px solid rgba(148,163,184,0.65);
          display:inline-block;
          position: relative;
          flex: 0 0 auto;
        }
        .finetune-card.selected .finetune-radio{
          border-color: rgba(255,107,0,0.85);
        }
        .finetune-card.selected .finetune-radio::after{
          content:"";
          position:absolute;
          inset: 3px;
          border-radius: 999px;
          background: rgba(255,107,0,0.95);
        }
        .finetune-detail{
          margin-top: 10px;
          padding-top: 10px;
          border-top: 1px dashed rgba(148,163,184,0.22);
          color: rgba(229,231,235,0.92);
          font-size: 12.5px;
          line-height: 1.55;
          font-weight: 750;
        }

        /* ======================================
           ‚úÖ Ï†ÑÏõîÏÑ∏ ÏßÄÎèÑ ÌéòÏù¥ÏßÄ Ï†ÑÏö© ÎÑ§ÎπÑÍ≤åÏù¥ÏÖòÎ∞î CSS (Í≥µÏö©) - ÏàòÏ†ï Í∏àÏßÄ
        ====================================== */
        .predict-navbar {
          background: linear-gradient(90deg, #0b1d33, #0f2a52);
          height: var(--nav-h);
          padding: 0 2rem !important;
          border-bottom: none;
        }

        .predict-navbar .nav-link {
          color: #fff !important;
          font-weight: 500;
          font-size: 1rem;
          transition: color 0.25s ease, transform 0.25s ease;
          display: inline-block;
        }

        .predict-navbar .nav-link:hover {
          color: #ff6b00 !important;
          transform: translateY(-2px);
        }

        .predict-navbar .navbar-brand img {
          height: 40px;
          filter: brightness(1.1);
        }

        .predict-navbar .navbar-toggler {
          border-color: rgba(255,255,255,0.5);
        }

        .predict-navbar .navbar-toggler-icon {
          filter: brightness(200%);
        }

        .chat-wrapper::-webkit-scrollbar,
        .settings::-webkit-scrollbar { width: 10px; }

        .chat-wrapper::-webkit-scrollbar-thumb,
        .settings::-webkit-scrollbar-thumb{
          background: rgba(148,163,184,0.28);
          border-radius: 999px;
          border: 2px solid rgba(17,24,39,0.55);
        }

        .chat-wrapper::-webkit-scrollbar-track,
        .settings::-webkit-scrollbar-track{
          background: rgba(0,0,0,0);
        }

        @media (max-width: 992px){
          .app{ grid-template-columns: 1fr; }
          .settings{ display:none; }
        }

        .finetune-detail{
          margin-top: 10px;
          padding-top: 10px;
          border-top: 1px dashed rgba(148,163,184,0.22);

          display: grid;
          gap: 8px;

          font-size: 12.5px;
          line-height: 1.45;
          font-weight: 750;
          color: rgba(229,231,235,0.92);
        }

        .ft-row{
          display: grid;
          grid-template-columns: 92px 1fr; /* ‚úÖ key Ìè≠ Í≥†Ï†ï */
          gap: 10px;
          align-items: start;
        }

        .ft-k{
          color: var(--muted);
          font-weight: 900;
          font-size: 12px;
          letter-spacing: -0.1px;
        }

        .ft-v{
          color: rgba(229,231,235,0.95);
          word-break: break-word;
        }

        .ft-code{
          font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
          font-size: 12px;
          padding: 2px 6px;
          border-radius: 8px;
          border: 1px solid rgba(148,163,184,0.22);
          background: rgba(15,23,42,0.35);
          color: rgba(229,231,235,0.95);
          white-space: nowrap;
        }

    </style>

    <script>
        // ‚úÖ ÏÑúÎ≤ÑÍ∞Ä Ï£ºÎäî "ÎîîÌè¥Ìä∏" (ÌéòÏù¥ÏßÄ Ïó¥ ÎïåÎßàÎã§ Ïù¥Í≤ÉÏúºÎ°ú ÏãúÏûë)
        const DEFAULT_PRESET = {{ (default_params if default_params is defined else (params if params is defined else {})) | tojson }};
        const DEFAULT_SYSTEM_PROMPT = {{ (default_system_prompt if default_system_prompt is defined else (system_prompt if system_prompt is defined else "")) | tojson }};

        // ‚úÖ Fine-tuning presets (ÏÑúÎ≤ÑÏóêÏÑú Ï£ºÎ©¥ Í∑∏Í±∏ Ïì∞Í≥†, ÏóÜÏúºÎ©¥ fallback ÏÇ¨Ïö©)
        // server expected:
        // finetune_presets: [{id,title,badge,recommended,short,detail}, ...]
        // default_finetune_id: "ckpt_50" Îì±
        const SERVER_FINETUNE_PRESETS = {{ (finetune_presets if finetune_presets is defined else []) | tojson }};
        const DEFAULT_FINETUNE_ID = {{ (default_finetune_id if default_finetune_id is defined else "") | tojson }};

        const FALLBACK_FINETUNE_PRESETS = [
          {
            id: "ckpt_50",
            title: "Checkpoint 50",
            badge: "step 50/100",
            recommended: true,
            short: "SFT runÏùò Ï§ëÍ∞Ñ Ïä§ÎÉÖÏÉ∑(global_step=50)",
            detail_kv: [
              { k: "Snapshot", v: "global_step=50 (max_steps=100, save_steps=50)" },
              { k: "Base",     v: "Meta-Llama-3-8B (4-bit NF4)" },
              { k: "PEFT",     v: "LoRA adapter-only (r=16, alpha=16)" },
              { k: "Objective",v: "completion-only loss (after ### Response)" },
            ],
          },
          {
            id: "ckpt_100",
            title: "Checkpoint 100",
            badge: "step 100/100",
            recommended: false,
            short: "SFT runÏùò ÏµúÏ¢Ö Ïä§ÎÉÖÏÉ∑(global_step=100)",
            detail_kv: [
              { k: "Snapshot", v: "global_step=100 (training end)" },
              { k: "Diff",    v: "ckpt_50Í≥º ÎèôÏùº ÏÑ§Ï†ï, stepÎßå Îã§Î¶Ñ (50 vs 100)" },
              { k: "Base",     v: "Meta-Llama-3-8B (4-bit NF4)" },
              { k: "PEFT",     v: "LoRA adapter-only (r=16, alpha=16)" },
              { k: "Objective",v: "completion-only loss (after ### Response)" },
            ],
          }
        ];

        const FINETUNE_PRESETS = (Array.isArray(SERVER_FINETUNE_PRESETS) && SERVER_FINETUNE_PRESETS.length)
          ? SERVER_FINETUNE_PRESETS
          : FALLBACK_FINETUNE_PRESETS;

        // ‚úÖ ÌÅ¥ÎùºÏóêÏÑúÎßå Ïú†ÏßÄÎêòÎäî "ÌòÑÏû¨ Ï†ÅÏö©Ï§ë" Í∞í(Ïø†ÌÇ§/ÏÑ∏ÏÖò Ï†ÄÏû• X)
        let appliedSystemPrompt = DEFAULT_SYSTEM_PROMPT;
        let appliedParams = { ...DEFAULT_PRESET };
        let appliedFinetuneId = DEFAULT_FINETUNE_ID || (FINETUNE_PRESETS[0] ? FINETUNE_PRESETS[0].id : "");

        const PARAM_SPECS = {
          temperature: {type: "float", min: 0.0, max: 2.0},
          top_p: {type: "float", min: 0.0, max: 1.0},
          top_k: {type: "int", min: 0, max: 200},
          max_tokens: {type: "int", min: 1, max: 4096},
          repetition_penalty: {type: "float", min: 0.5, max: 2.5},
        };

        function clamp(v, mn, mx){ return v > mx ? mx : (v < mn ? mn : v); }

        function coerceInput(key, raw){
          const spec = PARAM_SPECS[key];
          try{
            let v;
            if(spec.type === "int") v = parseInt(String(raw), 10);
            else v = parseFloat(String(raw));
            if(Number.isNaN(v)) throw new Error("NaN");
            v = clamp(v, spec.min, spec.max);
            // int Î≥¥Ïû•
            if(spec.type === "int") v = Math.trunc(v);
            return v;
          }catch(e){
            return DEFAULT_PRESET[key];
          }
        }

        function scrollToBottom(wrapper) {
          requestAnimationFrame(() => { wrapper.scrollTop = wrapper.scrollHeight; });
        }

        function bindRangeNumber(rangeEl, numberEl) {
          if (!rangeEl || !numberEl) return;

          const min = Number(rangeEl.min);
          const max = Number(rangeEl.max);
          const step = Number(rangeEl.step || 1);

          const clampToStep = (val) => {
            if (Number.isNaN(val)) return Number(rangeEl.value);
            let v = Math.min(max, Math.max(min, val));
            const decimals = (String(step).split(".")[1] || "").length;
            const snapped = Math.round((v - min) / step) * step + min;
            return Number(snapped.toFixed(decimals));
          };

          const syncFromRange = () => { numberEl.value = rangeEl.value; };
          const syncFromNumber = () => {
            const v = clampToStep(Number(numberEl.value));
            rangeEl.value = String(v);
            numberEl.value = String(v);
          };

          rangeEl.addEventListener("input", syncFromRange);
          numberEl.addEventListener("input", () => {
            const raw = Number(numberEl.value);
            if (Number.isNaN(raw)) return;
            rangeEl.value = Math.min(max, Math.max(min, raw));
          });
          numberEl.addEventListener("change", syncFromNumber);
          numberEl.addEventListener("blur", syncFromNumber);

          syncFromRange();
        }

        function setOverlay(show, text) {
          const overlay = document.getElementById("overlay");
          const box = document.getElementById("overlayText");
          if (text) box.textContent = text;
          overlay.style.display = show ? "flex" : "none";

          if (show) {
            document.body.dataset.prevOverflow = document.body.style.overflow || "";
            document.body.style.overflow = "hidden";
          } else {
            document.body.style.overflow = document.body.dataset.prevOverflow || "";
            delete document.body.dataset.prevOverflow;
          }
        }

        function setParam(id, value) {
          const range = document.getElementById(id);
          const num = document.getElementById(id + "_num");
          if (!range || !num) return;
          range.value = value;
          num.value = value;
          range.dispatchEvent(new Event("input"));
        }

        function promptPreview(text, n=140){
          const t = (text || "").replace(/\s+/g, " ").trim();
          if(!t) return "(ÎπÑÏñ¥ÏûàÏùå)";
          return t.length > n ? (t.slice(0, n) + "‚Ä¶") : t;
        }

        function finetuneLabelById(id){
          const x = FINETUNE_PRESETS.find(p => p.id === id);
          if(!x) return id || "(ÎØ∏ÏÑ†ÌÉù)";
          const badge = x.badge ? ` ¬∑ ${x.badge}` : "";
          return `${x.title}${badge}`;
        }

        function setSelectedFinetune(id){
          const hidden = document.getElementById("finetuneInput");
          if(hidden) hidden.value = id;

          const cards = document.querySelectorAll(".finetune-card");
          cards.forEach(c => c.classList.toggle("selected", c.dataset.id === id));
        }

        function renderFinetuneCards(selectedId){
          const grid = document.getElementById("finetuneGrid");
          if(!grid) return;

          grid.innerHTML = "";

          FINETUNE_PRESETS.forEach((p, idx) => {
            const card = document.createElement("div");
            card.className = "finetune-card" + (p.id === selectedId ? " selected" : "");
            card.dataset.id = p.id;

            const pillClass = p.recommended ? "pill rec" : "pill";
            const pillText = p.badge || (p.recommended ? "Ï∂îÏ≤ú" : "ÌîÑÎ¶¨ÏÖã");
            const detailId = `ft_detail_${idx}`;

            card.innerHTML = `
              <div class="finetune-top">
                <div class="finetune-title">
                  <span title="${(p.title || "").replace(/"/g, "&quot;")}">${p.title || ""}</span>
                  <span class="${pillClass}">${pillText}</span>
                </div>
                <span class="finetune-radio" aria-hidden="true"></span>
              </div>

              <div class="finetune-short">${p.short || ""}</div>

              <div class="finetune-actions">
                <button type="button" class="finetune-more" data-bs-toggle="collapse" data-bs-target="#${detailId}">
                  ÏÉÅÏÑ∏ Î≥¥Í∏∞
                </button>
                <span style="font-size:12px; color: var(--muted); font-weight:800;">ID: ${p.id}</span>
              </div>

              <div id="${detailId}" class="collapse">
                <div class="finetune-detail">
                  ${Array.isArray(p.detail_kv) ? p.detail_kv.map(row => `
                    <div class="ft-row">
                      <div class="ft-k">${row.k}</div>
                      <div class="ft-v">${formatDetailValue(row.v)}</div>
                    </div>
                  `).join("") : ""}
                </div>
              </div>
            `;

            // Ïπ¥Îìú ÌÅ¥Î¶≠ÏúºÎ°ú ÏÑ†ÌÉù. Îã®, ÏÉÅÏÑ∏Î≥¥Í∏∞ Î≤ÑÌäº ÌÅ¥Î¶≠ÏùÄ ÏÑ†ÌÉùÎèÑ Í∞ôÏù¥ ÎêòÎèÑÎ°ù(UX)
            card.addEventListener("click", () => setSelectedFinetune(p.id));

            grid.appendChild(card);
          });
        }

        function renderAppliedPanel(){
          // badge
          const badge = document.getElementById("appliedBadge");
          if (badge) badge.textContent = "Ï†ÅÏö©Îê®";

          // system prompt preview
          const sp = document.getElementById("appliedPrompt");
          if (sp) sp.textContent = promptPreview(appliedSystemPrompt, 160);

          // finetune
          const ft = document.getElementById("appliedFinetune");
          if (ft) ft.textContent = finetuneLabelById(appliedFinetuneId);

          // params
          const setKV = (id, v) => {
            const el = document.getElementById(id);
            if (el) el.textContent = String(v);
          };
          setKV("applied_temperature", appliedParams.temperature);
          setKV("applied_top_p", appliedParams.top_p);
          setKV("applied_top_k", appliedParams.top_k);
          setKV("applied_max_tokens", appliedParams.max_tokens);
          setKV("applied_repetition_penalty", appliedParams.repetition_penalty);
        }

        function readInputsToConfig(){
          const spInput = document.getElementById("systemPromptInput");
          const spRaw = spInput ? spInput.value : "";
          const sp = (spRaw || "").trim() || DEFAULT_SYSTEM_PROMPT;

          const ftHidden = document.getElementById("finetuneInput");
          const finetune_id = (ftHidden && ftHidden.value) ? ftHidden.value : appliedFinetuneId;

          const getNum = (id) => {
            const el = document.getElementById(id);
            return el ? el.value : "";
          };

          const params = {
            temperature: coerceInput("temperature", getNum("temperature_num")),
            top_p: coerceInput("top_p", getNum("top_p_num")),
            top_k: coerceInput("top_k", getNum("top_k_num")),
            max_tokens: coerceInput("max_tokens", getNum("max_tokens_num")),
            repetition_penalty: coerceInput("repetition_penalty", getNum("repetition_penalty_num")),
          };

          return { system_prompt: sp, finetune_id, params };
        }

        document.addEventListener("DOMContentLoaded", () => {
          const textarea = document.getElementById("prompt");
          const sendBtn = document.getElementById("send");
          const resetChatBtn = document.getElementById("resetChat");
          const resetChatForm = document.getElementById("resetChatForm");

          const chat = document.querySelector(".chat");
          const wrapper = document.querySelector(".chat-wrapper");

          const systemPromptInput = document.getElementById("systemPromptInput");

          const temperature = document.getElementById("temperature");
          const temperature_num = document.getElementById("temperature_num");
          const top_p = document.getElementById("top_p");
          const top_p_num = document.getElementById("top_p_num");
          const top_k = document.getElementById("top_k");
          const top_k_num = document.getElementById("top_k_num");
          const max_tokens = document.getElementById("max_tokens");
          const max_tokens_num = document.getElementById("max_tokens_num");
          const repetition_penalty = document.getElementById("repetition_penalty");
          const repetition_penalty_num = document.getElementById("repetition_penalty_num");

          // ‚úÖ Fine-tuning cards init (ÏûÖÎ†•Í∞íÏúºÎ°úÎßå ÏÑ∏ÌåÖ)
          renderFinetuneCards(appliedFinetuneId);
          setSelectedFinetune(appliedFinetuneId);

          // Ï¥àÍ∏∞ "Ï†ÅÏö©Ï§ë"ÏùÄ ÎîîÌè¥Ìä∏
          appliedSystemPrompt = DEFAULT_SYSTEM_PROMPT;
          appliedParams = { ...DEFAULT_PRESET };
          renderAppliedPanel();
          scrollToBottom(wrapper);

          // Send enable/disable
          sendBtn.disabled = true;
          textarea.addEventListener("input", () => {
            sendBtn.disabled = textarea.value.trim() === "";
          });

          textarea.addEventListener("keydown", (e) => {
            if (e.key === "Enter" && !e.shiftKey) {
              e.preventDefault();
              if (!sendBtn.disabled) sendBtn.click();
            }
          });

          let isSending = false;
          let isResetting = false;

          // ‚úÖ Send (Ìï≠ÏÉÅ "ÌòÑÏû¨ Ï†ÅÏö©Ï§ë" Í∞íÏùÑ JSONÏóê Ìè¨Ìï®Ìï¥ÏÑú Ï†ÑÏÜ°)
          sendBtn.addEventListener("click", async () => {
            if (isSending || isResetting) return;

            const text = textarea.value.trim();
            if (!text) return;

            isSending = true;

            const userMsg = document.createElement("div");
            userMsg.className = "msg user";
            userMsg.innerText = text;
            chat.appendChild(userMsg);

            const typing = document.createElement("div");
            typing.className = "msg assistant typing";
            typing.innerText = "";
            chat.appendChild(typing);

            scrollToBottom(wrapper);

            textarea.value = "";
            textarea.disabled = true;
            sendBtn.disabled = true;
            resetChatBtn.disabled = true;

            try {
              const res = await fetch("/llama", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({
                  prompt: text,
                  system_prompt: appliedSystemPrompt,
                  finetune_id: appliedFinetuneId,
                  ...appliedParams
                })
              });

              if (!res.ok) throw new Error("HTTP " + res.status);

              const ct = res.headers.get("content-type") || "";
              if (!ct.includes("application/json")) {
                throw new Error("Invalid response type");
              }

              const data = await res.json();

              typing.remove();

              const botMsg = document.createElement("div");
              botMsg.className = "msg assistant";
              botMsg.innerText = (data && data.answer) ? data.answer : "(Îπà ÏùëÎãµ)";
              chat.appendChild(botMsg);

              scrollToBottom(wrapper);

            } catch (err) {
              typing.remove();

              const errMsg = document.createElement("div");
              errMsg.className = "msg assistant";
              errMsg.innerText = "‚ö†Ô∏è Ïò§Î•ò Î∞úÏÉù\n" + err;
              chat.appendChild(errMsg);

              scrollToBottom(wrapper);
            } finally {
              textarea.disabled = false;
              textarea.focus();
              isSending = false;

              sendBtn.disabled = true;
              resetChatBtn.disabled = false;
            }
          });

          // ‚úÖ Reset Chat (ÏÑúÎ≤Ñ FORM Î¶¨ÏÖã + GET Ïû¨Î°úÎìú ‚Üí ÎîîÌè¥Ìä∏Î°ú Î≥µÍ∑Ä)
          resetChatBtn.addEventListener("click", () => {
            if (isSending || isResetting) return;

            const ok = confirm("ÎåÄÌôî ÎÇ¥Ïó≠ÏùÑ Î™®Îëê Ï¥àÍ∏∞ÌôîÌï†ÍπåÏöî?\n(ÏÉàÎ°úÍ≥†Ïπ®Ìï¥ÎèÑ Î≥µÍµ¨ÎêòÏßÄ ÏïäÏäµÎãàÎã§)");
            if (!ok) return;

            isResetting = true;

            textarea.disabled = true;
            sendBtn.disabled = true;
            resetChatBtn.disabled = true;

            setOverlay(true, "ÎåÄÌôî Ï¥àÍ∏∞ÌôîÏ§ëÏûÖÎãàÎã§‚Ä¶");

            resetChatForm.submit();
          });

          // Hyper Parameter Sync
          bindRangeNumber(temperature, temperature_num);
          bindRangeNumber(top_p, top_p_num);
          bindRangeNumber(top_k, top_k_num);
          bindRangeNumber(max_tokens, max_tokens_num);
          bindRangeNumber(repetition_penalty, repetition_penalty_num);

          // ‚úÖ Reset Params: "ÏûÖÎ†•Í∞íÎßå" ÎîîÌè¥Ìä∏Î°ú + system prompt ÏûÖÎ†•ÎèÑ ÎîîÌè¥Ìä∏Î°ú + finetune ÏûÖÎ†•ÎèÑ ÎîîÌè¥Ìä∏Î°ú (Ï†ÅÏö©ÏùÄ Apply)
          const resetParamsBtn = document.getElementById("resetParams");
          resetParamsBtn.addEventListener("click", () => {
            setParam("temperature", DEFAULT_PRESET.temperature);
            setParam("top_p", DEFAULT_PRESET.top_p);
            setParam("top_k", DEFAULT_PRESET.top_k);
            setParam("max_tokens", DEFAULT_PRESET.max_tokens);
            setParam("repetition_penalty", DEFAULT_PRESET.repetition_penalty);

            if (systemPromptInput) systemPromptInput.value = DEFAULT_SYSTEM_PROMPT;

            // finetune input reset (UIÎßå, Ï†ÅÏö©ÏùÄ Apply)
            const defFt = DEFAULT_FINETUNE_ID || (FINETUNE_PRESETS[0] ? FINETUNE_PRESETS[0].id : "");
            if(defFt) setSelectedFinetune(defFt);
          });

          // ‚úÖ Apply: ÏÑúÎ≤ÑÏóê Ï†ÄÏû•/Ï†ÑÏÜ° X, ÌÅ¥Îùº "Ï†ÅÏö©Ï§ë"Îßå Í∞±Ïã† + ÌòÑÌô©Ìåê ÏóÖÎç∞Ïù¥Ìä∏
          const paramForm = document.getElementById("paramForm");
          paramForm.addEventListener("submit", (e) => {
            e.preventDefault();

            setOverlay(true, "ÌîÑÎ°¨ÌîÑÌä∏&ÌïòÏù¥ÌçºÌååÎùºÎØ∏ÌÑ∞ Ï†ÅÏö©Ï§ëÏûÖÎãàÎã§‚Ä¶");

            const cfg = readInputsToConfig();
            appliedSystemPrompt = cfg.system_prompt;
            appliedParams = { ...cfg.params };
            appliedFinetuneId = cfg.finetune_id;

            renderAppliedPanel();

            // UX: Ïû†ÍπêÎßå Î≥¥Ïó¨Ï£ºÍ≥† Îã´Í∏∞
            setTimeout(() => setOverlay(false), 250);
          });

          // overlay ÏúÑÏóêÏÑú Ïù¥Î≤§Ìä∏ Î®πÍ∏∞
          const overlay = document.getElementById("overlay");
          overlay.addEventListener("click", (e) => e.preventDefault());
          overlay.addEventListener("wheel", (e) => e.preventDefault(), { passive: false });
          document.addEventListener("keydown", (e) => {
            if (overlay.style.display === "flex") e.preventDefault();
          }, { capture: true });
        });

        function formatDetailValue(v){
          const s = String(v ?? "");
          // Í¥ÑÌò∏/Îì±Ìò∏ Ìè¨Ìï®Îêú Íµ¨Í∞ÑÏùÄ ÏÇ¥Ïßù code ÎäêÎÇåÏúºÎ°ú Î≥¥Ïó¨Ï£ºÍ∏∞(Í≥ºÌïòÎ©¥ ÏßÄÏ†ÄÎ∂ÑÌï¥ÏßÄÎãà ÏµúÏÜåÎßå)
          return s
            .replace(/\b(global_step=\d+)\b/g, "<span class='ft-code'>$1</span>")
            .replace(/\b(max_steps=\d+)\b/g, "<span class='ft-code'>$1</span>")
            .replace(/\b(save_steps=\d+)\b/g, "<span class='ft-code'>$1</span>")
            .replace(/\b(4-bit NF4)\b/g, "<span class='ft-code'>$1</span>")
            .replace(/\b(LoRA)\b/g, "<span class='ft-code'>$1</span>");
        }
    </script>
</head>

<body>
<div class="overlay" id="overlay">
    <div class="overlay-box" id="overlayText">ÌîÑÎ°¨ÌîÑÌä∏&ÌïòÏù¥ÌçºÌååÎùºÎØ∏ÌÑ∞ Ï†ÅÏö©Ï§ëÏûÖÎãàÎã§‚Ä¶</div>
</div>

<div class="page-wrapper">

    <!-- ‚úÖ NAVIGATION BAR (Í≥µÏö©) - ÏàòÏ†ï Í∏àÏßÄ -->
    <nav class="navbar navbar-expand-lg predict-navbar">
        <div class="container-fluid px-4">
            <a class="navbar-brand" href="{{ url_for('index.index') }}">
                <img src="{{ url_for('static', filename='image/logo2.png') }}"
                     alt="Ï≤≠ÎÖÑ Ï£ºÍ±∞ ÏÜîÎ£®ÏÖò Î°úÍ≥†"
                     style="height:40px; width:auto;">
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#topNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="topNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item ms-3">
                        <a class="nav-link" href="{{ url_for('predict.predict_search') }}">Ï†ÑÏõîÏÑ∏ ÏòàÏ∏°</a>
                    </li>
                    <li class="nav-item ms-3">
                        <a class="nav-link" href="{{ url_for('support.support_search') }}">Ï†ïÎ∂ÄÏßÄÏõê</a>
                    </li>
                    <li class="nav-item ms-3">
                        <a class="nav-link" href="{{ url_for('login.login') }}">Î°úÍ∑∏Ïù∏</a>
                    </li>
                    <li class="nav-item ms-3">
                        <a class="nav-link" href="{{ url_for('login.signup') }}">ÌöåÏõêÍ∞ÄÏûÖ</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="app">

        <!-- LEFT -->
        <div class="main">
            <header>
                <div class="header-title">LLaMA3 8B Chat</div>

                <button id="resetChat" type="button" class="reset-chat-btn">Reset Chat</button>

                <!-- ‚úÖ resetÏùÄ ÏÑúÎ≤ÑÍ∞Ä redirectÎ°ú Ï≤òÎ¶¨ -->
                <form id="resetChatForm" method="post" style="display:none;">
                    <input type="hidden" name="action" value="reset_chat">
                </form>
            </header>

            <div class="chat-wrapper">
                <div class="chat">
                    {% for msg in chat_history %}
                    <div class="msg {{ msg.role }}">{{ msg.content }}</div>
                    {% endfor %}
                </div>
            </div>

            <div class="input-bar">
                <div class="input-inner">
                    <textarea id="prompt" rows="2" placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."></textarea>
                    <button id="send" type="button">Send</button>
                </div>
            </div>
        </div>

        <!-- RIGHT -->
        <form id="paramForm" method="post" class="settings">
            <!-- ‚úÖ ÌòÑÌô©Ìåê (ÌòÑÏû¨ Ï†ÅÏö©Ï§ë) -->
            <div class="status-card">
                <div class="status-top">
                    <div class="status-title">ÌòÑÏû¨ Ï†ÅÏö©Ï§ë</div>
                    <div id="appliedBadge" class="status-badge">ÎîîÌè¥Ìä∏</div>
                </div>

                <div class="status-row">
                    <div class="status-label">Fine-tuning</div>
                    <div class="status-value">
                        <span id="appliedFinetune" class="status-ellipsis"></span>
                    </div>
                </div>

                <div class="status-row">
                    <div class="status-label">System Prompt</div>
                    <div class="status-value">
                        <span id="appliedPrompt" class="status-ellipsis"></span>
                    </div>
                </div>

                <div class="status-grid">
                    <div class="kv">
                        <div class="k">temperature</div>
                        <div class="v" id="applied_temperature">-</div>
                    </div>
                    <div class="kv">
                        <div class="k">top_p</div>
                        <div class="v" id="applied_top_p">-</div>
                    </div>
                    <div class="kv">
                        <div class="k">top_k</div>
                        <div class="v" id="applied_top_k">-</div>
                    </div>
                    <div class="kv">
                        <div class="k">max_tokens</div>
                        <div class="v" id="applied_max_tokens">-</div>
                    </div>
                    <div class="kv">
                        <div class="k">repetition_penalty</div>
                        <div class="v" id="applied_repetition_penalty">-</div>
                    </div>
                </div>
            </div>

            <!-- ‚úÖ Fine-tuning Preset -->
            <div class="finetune-wrap">
                <div class="finetune-head">
                    <div class="finetune-head-left">
                        <div class="finetune-head-title">Fine-tuning</div>
                        <div class="finetune-head-desc">Ï≤¥ÌÅ¨Ìè¨Ïù∏Ìä∏(ÌîÑÎ¶¨ÏÖã)Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî ¬∑ Î≥ÄÍ≤ΩÏùÄ Îã§Ïùå Î©îÏãúÏßÄÎ∂ÄÌÑ∞ Ï†ÅÏö©</div>
                    </div>
                </div>

                <div id="finetuneGrid" class="finetune-grid"></div>
                <input type="hidden" id="finetuneInput" name="finetune_id" value="">
            </div>

            <h3>System Prompt</h3>
            <textarea id="systemPromptInput" name="system_prompt" rows="4">{{ default_system_prompt if default_system_prompt is defined else system_prompt }}</textarea>

            <h3 style="margin-top:16px;">Hyper Parameters</h3>

            <div class="param">
                <label>Temperature (Ï∞ΩÏùòÏÑ±/Î¨¥ÏûëÏúÑÏÑ±)</label>
                <div class="param-row">
                    <input id="temperature" type="range" min="0.1" max="1.5" step="0.1"
                           value="{{ default_params.temperature }}">
                    <input id="temperature_num" type="number" min="0.1" max="1.5" step="0.1"
                           value="{{ default_params.temperature }}">
                </div>
            </div>

            <div class="param">
                <label>Top-p (ÎàÑÏ†ÅÌôïÎ•† Í∏∞Ï§Ä)</label>
                <div class="param-row">
                    <input id="top_p" type="range" min="0.1" max="1" step="0.05" value="{{ default_params.top_p }}">
                    <input id="top_p_num" type="number" min="0.1" max="1" step="0.05"
                           value="{{ default_params.top_p }}">
                </div>
            </div>

            <div class="param">
                <label>Top-k (ÌõÑÎ≥¥ ÌÜ†ÌÅ∞ Í∞úÏàò)</label>
                <div class="param-row">
                    <input id="top_k" type="range" min="0" max="100" step="1" value="{{ default_params.top_k }}">
                    <input id="top_k_num" type="number" min="0" max="100" step="1" value="{{ default_params.top_k }}">
                </div>
            </div>

            <div class="param">
                <label>Max Tokens (ÏµúÎåÄ ÏÉùÏÑ± Í∏∏Ïù¥)</label>
                <div class="param-row">
                    <input id="max_tokens" type="range" min="32" max="2048" step="32"
                           value="{{ default_params.max_tokens }}">
                    <input id="max_tokens_num" type="number" min="32" max="2048" step="32"
                           value="{{ default_params.max_tokens }}">
                </div>
            </div>

            <div class="param">
                <label>Repetition Penalty (Î∞òÎ≥µ ÏñµÏ†ú Í∞ïÎèÑ)</label>
                <div class="param-row">
                    <input id="repetition_penalty" type="range" min="1" max="1.5" step="0.05"
                           value="{{ default_params.repetition_penalty }}">
                    <input id="repetition_penalty_num" type="number" min="1" max="1.5" step="0.05"
                           value="{{ default_params.repetition_penalty }}">
                </div>
            </div>

            <!-- ‚úÖ ApplyÎäî ÏÑúÎ≤Ñ Ï†ÄÏû• X: JSÍ∞Ä submitÏùÑ ÎßâÍ≥† 'Ï†ÅÏö©Ï§ë'Îßå Í∞±Ïã† -->
            <button type="button" id="resetParams">
                Reset to Default
            </button>

            <button class="apply" type="submit">Apply Settings</button>
        </form>

    </div>
</div>
</body>
</html>
